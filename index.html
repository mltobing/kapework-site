<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kapework ‚Äî Vibe Lab</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f8f7f4; --ink:#2b221b; --muted:#7a5e4b;
  --card:#fff; --line:#ece8e3; --accent:#b67b50; --accent-ink:#1b130f;
  --radius:16px; --max:940px;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.55 Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;display:flex;flex-direction:column;align-items:center}
header,main,footer{width:100%;max-width:var(--max);padding:16px}
header{padding-top:24px}
.brand{display:flex;gap:12px;align-items:center}
.logo{font-size:28px}
h1{margin:0;font-size:28px;font-weight:800;letter-spacing:.2px}
.tag{margin:6px 0 0;color:var(--muted)}
.toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:14px 0 6px}
.pill{border:1px solid var(--line);background:#fff;padding:8px 12px;border-radius:999px;font-weight:600}
.pill.primary{background:var(--accent);color:var(--accent-ink);border-color:#a06d47}
.divider{height:1px;background:linear-gradient(90deg,transparent,#eadfd3,transparent);margin:12px 0}
.grid{display:grid;gap:12px;margin-top:12px;grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}
.card{
  display:grid;grid-template-columns:56px 1fr;gap:12px;align-items:center;
  background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:14px 16px;
  box-shadow:0 10px 24px rgba(0,0,0,.05);cursor:pointer;transition:transform .12s ease, box-shadow .12s ease; -webkit-tap-highlight-color:transparent;
}
.card:active{transform:scale(.99)}
.emoji{width:56px;height:56px;display:grid;place-items:center;font-size:28px;background:#fff;border:1px solid var(--line);border-radius:12px}
.card h3{margin:0 0 4px;font-size:18px;font-weight:800}
.card p{margin:0;color:var(--muted)}
.actions{display:flex;gap:8px;margin-top:8px}
.mini{border:1px dashed var(--line);background:#fff;padding:6px 10px;border-radius:10px;font-size:14px;font-weight:600}
footer{color:var(--muted);text-align:center;padding-bottom:28px}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">üéÆ</div>
    <div><h1>Vibe Lab</h1><div class="tag">Tiny single-file web toys. Zero fuss.</div></div>
  </div>

  <!-- Generic profile + random -->
  <div class="toolbar">
    <button id="random" class="pill primary">Random app</button>
    <span class="pill">Profile: <b id="who">Guest</b></span>
    <button id="changeProfile" class="pill">Change</button>
  </div>
  <div class="divider"></div>
</header>

<main>
  <div id="grid" class="grid" aria-live="polite"></div>
</main>

<footer>¬© <span id="yr"></span> Kapework ¬∑ A small playground for tiny ideas</footer>

<script>
const WHO_KEY='kw_profile';
const whoSpan=document.getElementById('who');
function setProfile(name){ localStorage.setItem(WHO_KEY,name); whoSpan.textContent=name; }
setProfile(localStorage.getItem(WHO_KEY)||'Guest');
document.getElementById('changeProfile').onclick=()=>{
  const v=prompt('Choose a display name (optional):', localStorage.getItem(WHO_KEY)||'Guest');
  if(v!==null && v.trim()) setProfile(v.trim());
};

const grid=document.getElementById('grid'); let manifest=[];
fetch('/manifest.json').then(r=>r.json()).then(list=>{
  manifest=list;
  grid.innerHTML=list.map(x=>`
    <div class="card" role="button" tabindex="0" data-href="/apps/${x.slug}.html">
      <div class="emoji">${x.emoji||'üéõÔ∏è'}</div>
      <div>
        <h3>${x.title}</h3>
        <p>${x.blurb||''}</p>
        <div class="actions">
          <button class="mini" data-open="/apps/${x.slug}.html">Open</button>
          <button class="mini" data-open="/apps/${x.slug}.html?mode=daily">Daily</button>
        </div>
      </div>
    </div>
  `).join('');
}).catch(err=>{
  grid.innerHTML=`<div class="card"><div class="emoji">‚ö†Ô∏è</div><div><h3>Couldn‚Äôt load apps</h3><p>Check <code>/manifest.json</code>.</p></div></div>`;
  console.error(err);
});

// make whole card open; buttons have their own targets
grid.addEventListener('click',e=>{
  const btn=e.target.closest('[data-open]'); if(btn){ location.href=btn.dataset.open; return; }
  const card=e.target.closest('.card'); if(card){ location.href=card.dataset.href; }
});
grid.addEventListener('keydown',e=>{
  if(e.key==='Enter'){ const card=e.target.closest('.card'); if(card){ location.href=card.dataset.href; } }
});

document.getElementById('random').onclick=()=>{
  if(!manifest.length) return;
  const pick=manifest[Math.floor(Math.random()*manifest.length)];
  location.href='/apps/'+pick.slug+'.html';
};
document.getElementById('yr').textContent=new Date().getFullYear();
</script>
</body>
</html>
