<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="color-scheme" content="dark" />
<meta name="theme-color" content="#0a1628" />
<title>Kapework</title>
<style>
/* â”€â”€â”€ Reset & tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:       #0a1628;
  --surface:  #121e33;
  --surface2: #1a2a44;
  --border:   rgba(232,237,245,0.07);
  --border-hover: rgba(232,237,245,0.14);
  --cyan:     #00e5cc;
  --cyan-dim: rgba(0,229,204,0.10);
  --gold:     #ffd700;
  --text:     #e8edf5;
  --muted:    rgba(232,237,245,0.45);
  --success:  #4ade80;
  --tag-bg:   rgba(232,237,245,0.06);
}

html, body {
  min-height: 100%;
  background: var(--bg);
  color: var(--text);
}

body {
  font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
  -webkit-font-smoothing: antialiased;
}

a { color: inherit; text-decoration: none; }
button, select, textarea { font: inherit; }

/* â”€â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page {
  max-width: 960px;
  margin: 0 auto;
  padding: 24px 20px 64px;
}

/* â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.site-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  padding-bottom: 32px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 32px;
}

.wordmark {
  display: flex;
  align-items: baseline;
  gap: 2px;
}

.wordmark-text {
  font-size: 1.35rem;
  font-weight: 800;
  letter-spacing: -0.5px;
  color: var(--text);
}

.wordmark-dot {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--cyan);
  margin-left: 2px;
  margin-bottom: 2px;
  flex-shrink: 0;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Sort control */
.sort-wrap {
  display: flex;
  align-items: center;
  gap: 8px;
}

.sort-label {
  font-size: 0.8rem;
  color: var(--muted);
  white-space: nowrap;
}

select {
  background: var(--surface);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 7px 12px;
  font-size: 0.85rem;
  cursor: pointer;
  appearance: none;
  -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' fill='none'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23e8edf5' stroke-opacity='.4' stroke-width='1.5' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  padding-right: 28px;
  transition: border-color 0.15s;
}
select:hover { border-color: var(--border-hover); }
select:focus { outline: none; border-color: var(--cyan); }

/* â”€â”€â”€ Section heading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-meta {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}

.section-count {
  font-size: 0.8rem;
  color: var(--muted);
}

/* â”€â”€â”€ Game grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 14px;
}

/* â”€â”€â”€ Game card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
a.card {
  display: flex;
  flex-direction: column;
  gap: 12px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 18px;
  padding: 18px;
  cursor: pointer;
  transition: border-color 0.18s ease, transform 0.18s ease, box-shadow 0.18s ease;
  position: relative;
  overflow: hidden;
}

a.card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: radial-gradient(ellipse at top left, var(--cyan-dim) 0%, transparent 60%);
  opacity: 0;
  transition: opacity 0.25s ease;
  pointer-events: none;
}

a.card:hover {
  border-color: var(--border-hover);
  transform: translateY(-2px);
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}
a.card:hover::before { opacity: 1; }
a.card:active { transform: translateY(0) scale(0.99); }

/* Card top row */
.card-top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 10px;
}

.card-icon {
  width: 48px;
  height: 48px;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  flex-shrink: 0;
}

/* Like button */
button.like {
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 6px 10px;
  color: var(--muted);
  font-size: 0.8rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 4px;
  transition: color 0.15s, border-color 0.15s, background 0.15s;
  white-space: nowrap;
  flex-shrink: 0;
}
button.like:hover { color: var(--text); border-color: var(--border-hover); }
button.like.liked { color: #f87171; border-color: rgba(248,113,113,0.3); background: rgba(248,113,113,0.08); }

/* Card body */
.card-name {
  font-size: 1rem;
  font-weight: 700;
  color: var(--text);
  line-height: 1.2;
}

.card-blurb {
  font-size: 0.83rem;
  color: var(--muted);
  line-height: 1.5;
}

/* Tags */
.card-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: auto;
}

.tag {
  font-size: 0.72rem;
  font-weight: 600;
  color: var(--muted);
  background: var(--tag-bg);
  border: 1px solid var(--border);
  border-radius: 999px;
  padding: 3px 9px;
  letter-spacing: 0.2px;
}

/* Card footer */
.card-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-top: 10px;
  border-top: 1px solid var(--border);
}

.play-count {
  font-size: 0.8rem;
  color: var(--muted);
  display: flex;
  align-items: center;
  gap: 5px;
}

.play-arrow {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  background: var(--cyan-dim);
  border: 1px solid rgba(0,229,204,0.25);
  border-radius: 50%;
  color: var(--cyan);
  font-size: 0.7rem;
  transition: background 0.15s, border-color 0.15s;
}
a.card:hover .play-arrow {
  background: rgba(0,229,204,0.2);
  border-color: var(--cyan);
}

/* â”€â”€â”€ Empty / error state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.state-msg {
  grid-column: 1 / -1;
  padding: 48px 24px;
  text-align: center;
  color: var(--muted);
  font-size: 0.9rem;
}

/* â”€â”€â”€ Divider â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.divider {
  border: none;
  border-top: 1px solid var(--border);
  margin: 48px 0 36px;
}

/* â”€â”€â”€ Feedback section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.feedback-section {
  max-width: 560px;
}

.feedback-title {
  font-size: 1rem;
  font-weight: 700;
  margin-bottom: 4px;
}

.feedback-sub {
  font-size: 0.83rem;
  color: var(--muted);
  margin-bottom: 16px;
}

.feedback-attached {
  font-size: 0.78rem;
  color: var(--muted);
  margin-bottom: 8px;
}

.feedback-attached span {
  color: var(--cyan);
  font-weight: 600;
}

textarea {
  width: 100%;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  color: var(--text);
  padding: 12px 14px;
  resize: vertical;
  min-height: 80px;
  transition: border-color 0.15s;
  font-size: 0.88rem;
  line-height: 1.5;
}
textarea::placeholder { color: var(--muted); }
textarea:focus { outline: none; border-color: var(--cyan); }

.feedback-row {
  display: flex;
  justify-content: flex-end;
  align-items: center;
  gap: 12px;
  margin-top: 10px;
}

.feedback-status {
  font-size: 0.82rem;
  flex: 1;
}
.feedback-status.ok  { color: var(--success); }
.feedback-status.err { color: #f87171; }

.btn-send {
  background: var(--cyan);
  color: #0a1628;
  font-weight: 700;
  font-size: 0.88rem;
  border: none;
  border-radius: 10px;
  padding: 10px 20px;
  cursor: pointer;
  transition: opacity 0.15s, transform 0.15s;
  white-space: nowrap;
}
.btn-send:hover   { opacity: 0.9; }
.btn-send:active  { transform: scale(0.97); }
.btn-send:disabled { opacity: 0.4; cursor: default; }

/* â”€â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.site-footer {
  margin-top: 64px;
  padding-top: 24px;
  border-top: 1px solid var(--border);
  font-size: 0.78rem;
  color: var(--muted);
  text-align: center;
}
</style>
</head>
<body>
<div class="page">

  <!-- Header -->
  <header class="site-header">
    <div class="wordmark">
      <span class="wordmark-text">Kapework</span>
      <div class="wordmark-dot"></div>
    </div>
    <div class="header-right">
      <div class="sort-wrap">
        <span class="sort-label">Sort</span>
        <select id="sort" aria-label="Sort games">
          <option value="newest">Newest</option>
          <option value="name">A â€“ Z</option>
          <option value="likes">Most liked</option>
          <option value="plays">Most played</option>
        </select>
      </div>
    </div>
  </header>

  <!-- Grid -->
  <div class="section-meta">
    <span class="section-count" id="game-count"></span>
  </div>
  <div id="grid" class="grid" aria-live="polite"></div>

  <hr class="divider" />

  <!-- Feedback -->
  <section class="feedback-section">
    <div class="feedback-title">Quick feedback</div>
    <div class="feedback-sub">What's working? What could be better?</div>
    <div class="feedback-attached">Game: <span id="fb-target">General</span></div>
    <textarea id="fb-message" rows="3" placeholder="Tell us anything â€” a bug, an idea, a reaction."></textarea>
    <div class="feedback-row">
      <span class="feedback-status" id="fb-status"></span>
      <button class="btn-send" id="fb-send">Send</button>
    </div>
  </section>

  <footer class="site-footer">
    Kapework &mdash; small games, big ideas
  </footer>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
'use strict';

/* â”€â”€â”€ Supabase â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const SUPABASE_URL  = "https://fimsbfcvavpehryvvcho.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZpbXNiZmN2YXZwZWhyeXZ2Y2hvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzOTEwMDMsImV4cCI6MjA3MDk2NzAwM30.6uAm_bDPN9aetYaKWA7zCvS8XDEVhmKKxA7RA7YK4JQ";
const REST_PLAYS = `${SUPABASE_URL}/rest/v1/plays`;
const REST_LIKES = `${SUPABASE_URL}/rest/v1/likes`;
let sb = null;

/* â”€â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const gridEl     = document.getElementById("grid");
const sortSel    = document.getElementById("sort");
const gameCount  = document.getElementById("game-count");
const fbMsg      = document.getElementById("fb-message");
const fbSend     = document.getElementById("fb-send");
const fbStatus   = document.getElementById("fb-status");
const fbTarget   = document.getElementById("fb-target");

/* â”€â”€â”€ Local state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const DID_KEY   = "kapework_did_v1";
const LIKED_KEY = "kapework_liked_by_me_v1";
const LAST_KEY  = "kapework_last_played_slug";

let deviceId = localStorage.getItem(DID_KEY);
if (!deviceId) {
  deviceId = crypto?.randomUUID?.() || String(Math.random()).slice(2);
  localStorage.setItem(DID_KEY, deviceId);
}
let likedByMe = JSON.parse(localStorage.getItem(LIKED_KEY) || "{}");

let games      = [];
const bySlug   = new Map();
let likeCounts = new Map();
let playCounts = new Map();

/* â”€â”€â”€ Data loading â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadManifest() {
  try {
    const res  = await fetch("manifest.json?v=" + Date.now());
    if (!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();
    if (!Array.isArray(data)) throw new Error("not array");
    games = data;
    games.forEach(g => bySlug.set(g.slug, g));
  } catch (e) {
    gridEl.innerHTML = `<div class="state-msg">Could not load games: ${e.message}</div>`;
  }
}

async function loadCounts() {
  if (!sb) return;
  try {
    const { data } = await sb.from("game_like_counts").select();
    if (data) likeCounts = new Map(data.map(r => [r.slug, r.likes]));
  } catch (_) {}
  try {
    const { data } = await sb.from("game_play_counts").select();
    if (data) playCounts = new Map(data.map(r => [r.slug, r.plays]));
  } catch (_) {}
}

/* â”€â”€â”€ Sorting â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function sortGames(list, mode) {
  if (mode === "name")  return [...list].sort((a, b) => a.name.localeCompare(b.name));
  if (mode === "likes") return [...list].sort((a, b) => (likeCounts.get(b.slug) || 0) - (likeCounts.get(a.slug) || 0));
  if (mode === "plays") return [...list].sort((a, b) => (playCounts.get(b.slug) || 0) - (playCounts.get(a.slug) || 0));
  return [...list].sort((a, b) => new Date(b.released_at) - new Date(a.released_at));
}

/* â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function render() {
  gridEl.innerHTML = "";
  if (!games.length) {
    gridEl.innerHTML = `<div class="state-msg">No games yet.</div>`;
    return;
  }

  const sorted = sortGames(games, sortSel.value);
  gameCount.textContent = `${sorted.length} game${sorted.length !== 1 ? "s" : ""}`;

  sorted.forEach(g => {
    const liked    = !!likedByMe[g.slug];
    const likeNum  = likeCounts.get(g.slug) ?? 0;
    const playNum  = playCounts.get(g.slug) ?? 0;

    const card = document.createElement("a");
    card.className = "card";
    card.href      = g.url;
    card.target    = "_blank";
    card.rel       = "noopener";
    card.setAttribute("aria-label", `Play ${g.name}`);

    const tagsHtml = (g.tags || []).map(t => `<span class="tag">${t}</span>`).join("");

    card.innerHTML = `
      <div class="card-top">
        <div class="card-icon">${g.cover_emoji || "ğŸ®"}</div>
        <button type="button" class="like ${liked ? "liked" : ""}" data-slug="${g.slug}" aria-pressed="${liked}">
          ${liked ? "â¤ï¸" : "â™¡"} <span class="like-num">${likeNum}</span>
        </button>
      </div>
      <div class="card-name">${g.name}</div>
      ${g.blurb ? `<div class="card-blurb">${g.blurb}</div>` : ""}
      ${tagsHtml ? `<div class="card-tags">${tagsHtml}</div>` : ""}
      <div class="card-footer">
        <span class="play-count">â–¶ ${playNum}</span>
        <span class="play-arrow">â†’</span>
      </div>
    `;

    /* Track play on navigation */
    card.addEventListener("click", e => {
      localStorage.setItem(LAST_KEY, g.slug);
      playCounts.set(g.slug, (playCounts.get(g.slug) || 0) + 1);
      const pc = card.querySelector(".play-count");
      if (pc) pc.textContent = `â–¶ ${playCounts.get(g.slug)}`;
      if (sortSel.value === "plays") setTimeout(render, 0);

      fetch(REST_PLAYS, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "apikey": SUPABASE_ANON,
          "Authorization": `Bearer ${SUPABASE_ANON}`,
          "Prefer": "return=minimal"
        },
        body: JSON.stringify({ slug: g.slug, device_id: deviceId }),
        keepalive: true
      }).catch(() => {});
    });

    /* Like button */
    card.querySelector("button.like").addEventListener("click", async e => {
      e.preventDefault();
      e.stopPropagation();
      const slug = e.currentTarget.dataset.slug;
      if (likedByMe[slug]) return;

      likedByMe[slug] = true;
      localStorage.setItem(LIKED_KEY, JSON.stringify(likedByMe));
      likeCounts.set(slug, (likeCounts.get(slug) || 0) + 1);

      const btn  = e.currentTarget;
      const numEl = btn.querySelector(".like-num");
      btn.classList.add("liked");
      btn.setAttribute("aria-pressed", "true");
      btn.firstChild.textContent = "â¤ï¸ ";
      if (numEl) numEl.textContent = likeCounts.get(slug);
      if (sortSel.value === "likes") render();

      fetch(REST_LIKES, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "apikey": SUPABASE_ANON,
          "Authorization": `Bearer ${SUPABASE_ANON}`,
          "Prefer": "return=minimal"
        },
        body: JSON.stringify({ slug, device_id: deviceId }),
        keepalive: true
      }).catch(() => {});
    });

    gridEl.appendChild(card);
  });
}

/* â”€â”€â”€ Feedback attachment label â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function refreshAttachLabel() {
  const last = localStorage.getItem(LAST_KEY);
  fbTarget.textContent = (last && bySlug.has(last))
    ? bySlug.get(last).name
    : "General";
}

/* â”€â”€â”€ Send feedback â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function sendFeedback() {
  const message = fbMsg.value.trim();
  if (!message) {
    fbStatus.textContent = "Please write something first.";
    fbStatus.className   = "feedback-status err";
    return;
  }
  if (!sb) {
    fbStatus.textContent = "Feedback service unavailable â€” reload and try again.";
    fbStatus.className   = "feedback-status err";
    return;
  }

  const last = localStorage.getItem(LAST_KEY);
  const slug = (last && bySlug.has(last)) ? last : "general";

  fbSend.disabled      = true;
  fbStatus.textContent = "Sendingâ€¦";
  fbStatus.className   = "feedback-status";

  const { error } = await sb.from("feedback").insert({ slug, message });

  if (error) {
    fbStatus.textContent = "Could not send â€” please try again.";
    fbStatus.className   = "feedback-status err";
  } else {
    fbStatus.textContent = "Sent! Thank you.";
    fbStatus.className   = "feedback-status ok";
    fbMsg.value          = "";
  }
  fbSend.disabled = false;
}

/* â”€â”€â”€ Events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
sortSel.addEventListener("change", render);
fbSend.addEventListener("click", sendFeedback);

document.addEventListener("visibilitychange", async () => {
  if (!document.hidden) {
    await loadCounts();
    render();
    refreshAttachLabel();
  }
});

/* â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
window.addEventListener("load", async () => {
  try { sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON); } catch (e) {}
  await loadManifest();
  await loadCounts();
  render();
  refreshAttachLabel();
});
</script>
</body>
</html>
