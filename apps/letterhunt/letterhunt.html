<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="color-scheme" content="dark">
<meta name="theme-color" content="#0a1628">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Letter Hunt | Kapework</title>
<style>
/* â”€â”€â”€ Reset & Root â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

:root {
  --bg:        #0a1628;
  --surface:   #121e33;
  --surface2:  #1a2a44;
  --cyan:      #00e5cc;
  --cyan-dim:  rgba(0,229,204,0.15);
  --cyan-glow: rgba(0,229,204,0.35);
  --success:   #4ade80;
  --success-dim: rgba(74,222,128,0.15);
  --gold:      #ffd700;
  --fire:      #ff6b35;
  --text:      #e8edf5;
  --muted:     rgba(232,237,245,0.5);
  --border:    rgba(232,237,245,0.08);
  --shake-color: rgba(232,237,245,0.06);
}

html, body {
  height: 100%;
  background: var(--bg);
  overscroll-behavior: none;
  -webkit-overflow-scrolling: auto;
}

html { position: fixed; width: 100%; }

body {
  font-family: 'DM Sans', system-ui, -apple-system, sans-serif;
  color: var(--text);
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100dvh;
  touch-action: manipulation;
  -webkit-user-select: none;
  user-select: none;
  overflow: hidden;
}

/* â”€â”€â”€ Screens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.screen {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 16px 16px env(safe-area-inset-bottom, 16px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
  overflow-y: auto;
  overflow-x: hidden;
}
.screen.active {
  opacity: 1;
  pointer-events: all;
}

/* â”€â”€â”€ Home Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#home {
  justify-content: flex-start;
  gap: 20px;
  padding-top: 32px;
}

.home-header {
  text-align: center;
}

.home-logo {
  font-size: 3rem;
  line-height: 1;
}

.home-title {
  font-size: 1.75rem;
  font-weight: 800;
  letter-spacing: -0.5px;
  color: var(--text);
  margin-top: 8px;
}

.home-subtitle {
  font-size: 0.9rem;
  color: var(--muted);
  margin-top: 4px;
}

/* Streak bar */
.streak-bar {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 999px;
  padding: 10px 20px;
  font-size: 1.1rem;
  font-weight: 700;
}

.streak-flame { font-size: 1.3rem; }
.streak-count { color: var(--fire); font-size: 1.3rem; font-weight: 800; }
.streak-label { color: var(--muted); font-size: 0.85rem; }

/* Game mode cards */
.mode-cards {
  display: flex;
  flex-direction: column;
  gap: 14px;
  width: 100%;
  max-width: 420px;
}

.mode-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 20px;
  cursor: pointer;
  transition: transform 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease;
  display: flex;
  align-items: center;
  gap: 16px;
}

.mode-card:hover { transform: translateY(-2px); }
.mode-card:active { transform: scale(0.98); }

.mode-card.ready { border-color: var(--cyan); box-shadow: 0 0 20px var(--cyan-dim); }
.mode-card.done  { border-color: var(--success); box-shadow: 0 0 20px var(--success-dim); }

.mode-icon { font-size: 2.5rem; flex-shrink: 0; }

.mode-info { flex: 1; }
.mode-name { font-size: 1.1rem; font-weight: 800; }
.mode-desc { font-size: 0.85rem; color: var(--muted); margin-top: 2px; }

.mode-status {
  font-size: 0.8rem;
  font-weight: 700;
  padding: 4px 10px;
  border-radius: 999px;
  flex-shrink: 0;
}
.mode-status.play  { background: var(--cyan-dim); color: var(--cyan); border: 1px solid var(--cyan); }
.mode-status.done  { background: var(--success-dim); color: var(--success); border: 1px solid var(--success); }
.mode-status.stars { background: rgba(255,215,0,0.15); color: var(--gold); border: 1px solid var(--gold); }

.home-footer {
  margin-top: auto;
  color: var(--muted);
  font-size: 0.75rem;
  text-align: center;
  padding-bottom: 8px;
}

/* â”€â”€â”€ Game Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#game {
  justify-content: flex-start;
  padding-top: 16px;
  gap: 0;
}

/* Top bar */
.top-bar {
  width: 100%;
  max-width: 480px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.back-btn {
  background: none;
  border: none;
  color: var(--muted);
  font-size: 1.5rem;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 8px;
  transition: color 0.15s;
  line-height: 1;
}
.back-btn:hover { color: var(--text); }

/* Round dots */
.round-dots {
  display: flex;
  gap: 6px;
  align-items: center;
}

.dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--border);
  border: 1.5px solid var(--muted);
  transition: background 0.3s, border-color 0.3s;
}
.dot.done { background: var(--cyan); border-color: var(--cyan); }
.dot.current { background: var(--cyan-dim); border-color: var(--cyan); }

/* Streak chip */
.streak-chip {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 0.95rem;
  font-weight: 700;
  color: var(--fire);
}

/* Letter zone */
.letter-zone {
  width: 100%;
  max-width: 480px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
}

.letter-display {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.letter-label {
  font-size: 0.75rem;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 1px;
}

.letter-chars {
  font-size: 3.5rem;
  font-weight: 900;
  line-height: 1;
  color: var(--cyan);
  letter-spacing: 8px;
  /* OpenDyslexic-style: use a clear, weighted font */
  font-family: Georgia, 'Times New Roman', serif;
}

.letter-hint {
  font-size: 0.85rem;
  color: var(--muted);
  margin-top: 2px;
}

.speaker-btn {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: var(--cyan-dim);
  border: 2px solid var(--cyan);
  color: var(--cyan);
  font-size: 1.6rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.15s, background 0.15s;
  flex-shrink: 0;
}
.speaker-btn:hover { background: rgba(0,229,204,0.25); }
.speaker-btn:active { transform: scale(0.92); }
.speaker-btn.playing { animation: pulse-speaker 0.6s ease; }

@keyframes pulse-speaker {
  0%   { transform: scale(1); }
  40%  { transform: scale(1.15); }
  100% { transform: scale(1); }
}

/* Round instruction */
.round-instruction {
  width: 100%;
  max-width: 480px;
  text-align: center;
  font-size: 0.9rem;
  color: var(--muted);
  margin-bottom: 14px;
}

/* Picture grid */
.picture-grid {
  width: 100%;
  max-width: 480px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  flex: 1;
}

/* Picture cards */
.pic-card {
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: 18px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 0;
  padding: 8px;
  cursor: pointer;
  transition:
    transform 0.15s ease,
    border-color 0.2s ease,
    background 0.2s ease,
    opacity 0.2s ease;
  min-height: 100px;
  position: relative;
  overflow: hidden;
}

.pic-card:active:not(.correct):not(.locked-out) { transform: scale(0.96); }

.pic-card.correct {
  background: var(--success-dim);
  border-color: var(--success);
  cursor: default;
  animation: card-pop 0.35s ease;
}

@keyframes card-pop {
  0%   { transform: scale(1); }
  50%  { transform: scale(1.1); }
  100% { transform: scale(1); }
}

.pic-card.shake {
  animation: card-shake 0.35s ease;
}

@keyframes card-shake {
  0%   { transform: translateX(0); }
  20%  { transform: translateX(-5px); }
  40%  { transform: translateX(5px); }
  60%  { transform: translateX(-4px); }
  80%  { transform: translateX(4px); }
  100% { transform: translateX(0); }
}

.pic-card.locked-out {
  opacity: 0.4;
  cursor: default;
  pointer-events: none;
}

.pic-emoji {
  font-size: 4.5rem;
  line-height: 1;
  transition: transform 0.2s ease;
}
.pic-card.correct .pic-emoji { transform: scale(1.1); }

.pic-word {
  font-size: 0.8rem;
  font-weight: 700;
  color: var(--muted);
  text-align: center;
  letter-spacing: 0.3px;
  transition: color 0.2s;
}
.pic-card.correct .pic-word { color: var(--success); }

/* Initial letter highlight in word */
.pic-word .initial {
  color: var(--cyan);
  font-size: 1em;
}
.pic-card.correct .pic-word .initial { color: var(--success); font-weight: 900; }

/* Checkmark overlay */
.pic-check {
  position: absolute;
  top: 6px;
  right: 8px;
  font-size: 1rem;
  opacity: 0;
  transition: opacity 0.2s;
}
.pic-card.correct .pic-check { opacity: 1; }

/* â”€â”€â”€ Summary Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#summary {
  justify-content: center;
  gap: 24px;
  text-align: center;
}

.summary-title {
  font-size: 1.4rem;
  font-weight: 800;
  color: var(--text);
}

.summary-date {
  font-size: 0.85rem;
  color: var(--muted);
}

/* Stars */
.stars-row {
  display: flex;
  gap: 12px;
  justify-content: center;
}

.star {
  font-size: 3rem;
  opacity: 0.2;
  transition: opacity 0.3s ease, transform 0.3s ease;
  transform: scale(0.8);
}
.star.earned {
  opacity: 1;
  transform: scale(1.1);
  animation: star-pop 0.4s ease forwards;
  filter: drop-shadow(0 0 8px var(--gold));
}

@keyframes star-pop {
  0%   { transform: scale(0); opacity: 0; }
  60%  { transform: scale(1.3); opacity: 1; }
  100% { transform: scale(1.1); opacity: 1; }
}

.star-label {
  font-size: 1rem;
  font-weight: 700;
  color: var(--gold);
}

/* Collectible card */
.card-reveal {
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: 20px;
  padding: 24px;
  width: 200px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  animation: card-flip 0.6s ease;
}

.card-reveal.rare {
  border-color: var(--gold);
  box-shadow: 0 0 30px rgba(255,215,0,0.3);
}

@keyframes card-flip {
  0%   { transform: rotateY(90deg); opacity: 0; }
  100% { transform: rotateY(0deg); opacity: 1; }
}

.card-emoji { font-size: 3.5rem; }
.card-name  { font-size: 0.85rem; color: var(--muted); font-weight: 700; }
.card-rarity { font-size: 0.75rem; color: var(--gold); }

/* Streak summary */
.summary-streak {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 1.1rem;
  font-weight: 700;
}

/* Share / Done buttons */
.summary-actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
  width: 100%;
  max-width: 320px;
}

.btn-primary {
  background: var(--cyan);
  color: #0a1628;
  font-weight: 800;
  font-size: 1rem;
  border: none;
  border-radius: 14px;
  padding: 16px;
  cursor: pointer;
  transition: opacity 0.15s, transform 0.15s;
  width: 100%;
}
.btn-primary:hover { opacity: 0.9; }
.btn-primary:active { transform: scale(0.97); }

.btn-secondary {
  background: transparent;
  color: var(--muted);
  font-weight: 700;
  font-size: 0.9rem;
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 14px;
  cursor: pointer;
  transition: color 0.15s, border-color 0.15s;
  width: 100%;
}
.btn-secondary:hover { color: var(--text); border-color: var(--muted); }

/* â”€â”€â”€ Confetti â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.confetti-container {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 100;
  overflow: hidden;
}

.confetti-piece {
  position: absolute;
  width: 10px;
  height: 10px;
  border-radius: 2px;
  animation: confetti-fall 1.2s ease-in forwards;
  opacity: 0;
}

@keyframes confetti-fall {
  0%   { transform: translateY(-20px) rotate(0deg); opacity: 1; }
  100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

/* â”€â”€â”€ Round transition â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.picture-grid.slide-out {
  animation: slide-out-left 0.25s ease forwards;
}
.picture-grid.slide-in {
  animation: slide-in-right 0.25s ease;
}
@keyframes slide-out-left {
  from { transform: translateX(0); opacity: 1; }
  to   { transform: translateX(-60px); opacity: 0; }
}
@keyframes slide-in-right {
  from { transform: translateX(60px); opacity: 0; }
  to   { transform: translateX(0); opacity: 1; }
}

/* â”€â”€â”€ Reduced motion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    transition-duration: 0.01ms !important;
  }
}

/* â”€â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toast {
  position: fixed;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 24px);
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 999px;
  padding: 10px 20px;
  font-size: 0.9rem;
  font-weight: 700;
  color: var(--text);
  z-index: 200;
  opacity: 0;
  transition: opacity 0.2s, transform 0.2s;
  white-space: nowrap;
  pointer-events: none;
}
.toast.visible {
  opacity: 1;
  transform: translateX(-50%) translateY(0);
}

/* â”€â”€â”€ Paw button (home screen) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.paw-btn {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  color: var(--muted);
  font-family: inherit;
  font-size: 0.88rem;
  font-weight: 700;
  padding: 10px 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: color 0.15s, border-color 0.15s;
}
.paw-btn:hover { color: var(--text); border-color: rgba(232,237,245,0.18); }
.paw-btn:active { transform: scale(0.97); }

/* â”€â”€â”€ Gallery Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#gallery {
  justify-content: flex-start;
  padding-top: 16px;
  gap: 0;
}

.gallery-heading {
  font-size: 1.1rem;
  font-weight: 800;
}

.gallery-count {
  font-size: 0.8rem;
  color: var(--muted);
}

.gallery-grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 12px;
  padding: 16px 0 32px;
  width: 100%;
}

/* Badge bounce */
@keyframes badge-bounce {
  0%   { transform: scale(1)    rotate(0deg); }
  25%  { transform: scale(1.30) rotate(-9deg); }
  55%  { transform: scale(0.90) rotate(5deg); }
  80%  { transform: scale(1.07) rotate(-2deg); }
  100% { transform: scale(1)    rotate(0deg); }
}

/* Rare badge shimmer sweep */
@keyframes badge-shine {
  0%   { background-position: -200% center; }
  100% { background-position: 200% center; }
}

/* Individual badge */
.gc {
  width: 90px;
  height: 90px;
  border-radius: 22px;
  background: var(--surface);
  border: 2px solid var(--border);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 3px;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  -webkit-tap-highlight-color: transparent;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.gc.bounce {
  animation: badge-bounce 0.48s ease;
}

.gc.gc-rare {
  border-color: var(--gold);
  box-shadow: 0 0 16px rgba(255,215,0,0.30);
}

.gc.gc-rare::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    105deg,
    transparent 38%,
    rgba(255,215,0,0.22) 50%,
    transparent 62%
  );
  background-size: 200% 100%;
  animation: badge-shine 3.2s ease infinite;
  pointer-events: none;
}

.gc-emoji {
  font-size: 2.8rem;
  line-height: 1;
}

.gc-name {
  font-size: 0.6rem;
  font-weight: 700;
  color: var(--muted);
  text-align: center;
  line-height: 1.2;
}

/* Empty state */
.gallery-empty {
  width: 100%;
  padding: 56px 16px;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}

.gallery-empty-icon { font-size: 3.5rem; }

.gallery-empty-text {
  font-size: 0.95rem;
  color: var(--muted);
  line-height: 1.6;
  max-width: 240px;
}

/* â”€â”€â”€ Sight Word Dash â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#sw-game {
  justify-content: flex-start;
  padding-top: 16px;
  gap: 0;
}

/* Target word â€” reuses letter-chars sizing but needs fade + pointer */
.sw-word {
  cursor: pointer;
  transition: opacity 0.5s ease;
  -webkit-tap-highlight-color: transparent;
}
.sw-word.faded { opacity: 0.35; }

/* 2Ã—2 options grid */
.sw-options-grid {
  width: 100%;
  max-width: 480px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  flex: 1;
}

.sw-options-grid.slide-out { animation: slide-out-left 0.25s ease forwards; }
.sw-options-grid.slide-in  { animation: slide-in-right 0.25s ease; }

.sw-option {
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: 18px;
  padding: 16px 8px;
  font-size: 1.7rem;
  font-weight: 900;
  color: var(--text);
  font-family: Georgia, 'Times New Roman', serif;
  letter-spacing: 1px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 76px;
  transition: transform 0.15s ease, border-color 0.2s ease, background 0.2s ease;
  -webkit-tap-highlight-color: transparent;
}
.sw-option:active:not(.correct):not(.locked-out) { transform: scale(0.96); }
.sw-option.correct {
  background: var(--success-dim);
  border-color: var(--success);
  cursor: default;
  animation: card-pop 0.35s ease;
}
.sw-option.shake     { animation: card-shake 0.35s ease; }
.sw-option.locked-out { opacity: 0.4; cursor: default; pointer-events: none; }

/* â”€â”€â”€ Word Match â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#wm-game {
  justify-content: flex-start;
  padding-top: 16px;
  gap: 0;
}

.wm-area {
  position: relative;
  display: flex;
  gap: 20px;
  padding: 8px 0;
  width: 100%;
  max-width: 480px;
  flex: 1;
  align-items: stretch;
}

.wm-lines {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 1;
  overflow: visible;
}

.wm-col {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 14px;
  justify-content: center;
}

.wm-word {
  background: var(--surface);
  border: 2px solid var(--border);
  border-radius: 16px;
  padding: 14px 10px;
  font-size: 1.7rem;
  font-weight: 900;
  font-family: Georgia, 'Times New Roman', serif;
  letter-spacing: 1px;
  text-align: center;
  cursor: pointer;
  transition: border-color 0.2s ease, background 0.2s ease, opacity 0.3s ease, transform 0.15s ease;
  position: relative;
  z-index: 2;
  touch-action: none;
  -webkit-tap-highlight-color: transparent;
}

.wm-word:active:not(.matched) { transform: scale(0.96); }

.wm-left .wm-word:not(.matched):not(.selected) {
  border-left: 4px solid var(--cyan-dim);
}

.wm-word.selected {
  border-color: var(--cyan);
  background: var(--cyan-dim);
  box-shadow: 0 0 16px var(--cyan-dim);
}

.wm-word.matched {
  background: var(--success-dim);
  border-color: var(--success);
  opacity: 0.6;
  cursor: default;
}

.wm-word.shake {
  animation: card-shake 0.35s ease;
}

.wm-line {
  stroke: var(--cyan);
  stroke-width: 3;
  stroke-linecap: round;
  opacity: 0;
  transition: opacity 0.3s ease;
}
.wm-line.active {
  opacity: 1;
}
.wm-line.matched {
  stroke: var(--success);
  opacity: 0.4;
  transition: stroke 0.5s ease, opacity 0.5s ease;
}
.wm-line.temp {
  opacity: 0.6;
  stroke-dasharray: 8 4;
}

/* â”€â”€â”€ Utilities â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.w-full { width: 100%; }
.max-w  { max-width: 480px; }
</style>
</head>
<body>

<!-- â”€â”€â”€ Home Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="home" class="screen active">
  <div class="home-header">
    <div class="home-logo">ğŸ”¤</div>
    <h1 class="home-title">Letter Hunt</h1>
    <p class="home-subtitle">Find the matching sounds</p>
  </div>

  <div class="streak-bar">
    <span class="streak-flame">ğŸ”¥</span>
    <span class="streak-count" id="home-streak">0</span>
    <span class="streak-label">day streak</span>
  </div>

  <div class="mode-cards">
    <div id="lh-card" class="mode-card ready" onclick="startLetterHunt()">
      <div class="mode-icon">ğŸ”</div>
      <div class="mode-info">
        <div class="mode-name">Letter Hunt</div>
        <div class="mode-desc">5 rounds Â· match sounds to pictures</div>
      </div>
      <div id="lh-status" class="mode-status play">Play</div>
    </div>

    <div id="sw-card" class="mode-card ready" onclick="startSightWordDash()">
      <div class="mode-icon">ğŸ“–</div>
      <div class="mode-info">
        <div class="mode-name">Sight Word Dash</div>
        <div class="mode-desc">8 words Â· tap the matching word</div>
      </div>
      <div id="sw-status" class="mode-status play">Play</div>
    </div>

    <div id="wm-card" class="mode-card ready" onclick="startWordMatch()">
      <div class="mode-icon">âœï¸</div>
      <div class="mode-info">
        <div class="mode-name">Word Match</div>
        <div class="mode-desc">4 rounds Â· match the words</div>
      </div>
      <div id="wm-status" class="mode-status play">Play</div>
    </div>
  </div>

  <button class="paw-btn" onclick="openGallery()" aria-label="My Animals collection">
    ğŸ¾ My Animals
  </button>

  <div class="home-footer">
    Kapework Â· Letter Hunt Â· Tiers 1â€“5
  </div>
</div>

<!-- â”€â”€â”€ Game Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="game" class="screen">
  <div class="top-bar w-full max-w">
    <button class="back-btn" onclick="goHome()" aria-label="Back to home">â†</button>
    <div class="round-dots" id="round-dots"></div>
    <div class="streak-chip">
      <span>ğŸ”¥</span>
      <span id="game-streak">0</span>
    </div>
  </div>

  <div class="letter-zone w-full max-w">
    <div class="letter-display">
      <div class="letter-label">Find things that start with</div>
      <div class="letter-chars" id="letter-chars">S s</div>
      <div class="letter-hint" id="letter-hint">as in ğŸ snake</div>
    </div>
    <button class="speaker-btn" id="speaker-btn" onclick="playLetterSound()" aria-label="Hear the sound">ğŸ”Š</button>
  </div>

  <div class="round-instruction" id="round-instruction">
    Tap the 2 pictures that start with this sound
  </div>

  <div class="picture-grid" id="picture-grid"></div>
</div>

<!-- â”€â”€â”€ Summary Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="summary" class="screen">
  <div>
    <div class="summary-title" id="summary-title">Well done!</div>
    <div class="summary-date" id="summary-date"></div>
  </div>

  <div class="stars-row" id="stars-row">
    <div class="star" id="star1">â­</div>
    <div class="star" id="star2">â­</div>
    <div class="star" id="star3">â­</div>
  </div>
  <div class="star-label" id="star-label">Great job!</div>

  <div class="card-reveal" id="card-reveal">
    <div class="card-emoji" id="card-emoji">ğŸ¦</div>
    <div class="card-name" id="card-name">Lion</div>
    <div class="card-rarity" id="card-rarity">Today's card</div>
  </div>

  <div class="summary-streak">
    <span>ğŸ”¥</span>
    <span id="summary-streak-count">0</span>
    <span style="color:var(--muted);font-size:0.9rem">day streak</span>
  </div>

  <div class="summary-actions">
    <button class="btn-secondary" onclick="shareResult()" id="share-btn">Share result</button>
    <button class="btn-primary" onclick="goHome()">Done!</button>
  </div>
</div>

<!-- â”€â”€â”€ Sight Word Dash Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="sw-game" class="screen">
  <div class="top-bar w-full max-w">
    <button class="back-btn" onclick="goHome()" aria-label="Back to home">â†</button>
    <div class="round-dots" id="sw-dots"></div>
    <div class="streak-chip">
      <span>ğŸ”¥</span>
      <span id="sw-game-streak">0</span>
    </div>
  </div>

  <div class="letter-zone w-full max-w">
    <div class="letter-display">
      <div class="letter-label">Find this word</div>
      <div class="letter-chars sw-word" id="sw-word" onclick="onSWWordTap()">the</div>
    </div>
    <button class="speaker-btn" id="sw-speaker-btn" onclick="playSWWord()" aria-label="Hear the word">ğŸ”Š</button>
  </div>

  <div class="round-instruction">Tap the matching word</div>

  <div class="sw-options-grid" id="sw-options-grid"></div>
</div>

<!-- â”€â”€â”€ Word Match Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="wm-game" class="screen">
  <div class="top-bar w-full max-w">
    <button class="back-btn" onclick="goHome()" aria-label="Back to home">â†</button>
    <div class="round-dots" id="wm-dots"></div>
    <div class="streak-chip">
      <span>ğŸ”¥</span>
      <span id="wm-game-streak">0</span>
    </div>
  </div>

  <div class="round-instruction">Match each word on the left to its twin on the right</div>

  <div class="wm-area" id="wm-area">
    <svg class="wm-lines" id="wm-lines"></svg>
    <div class="wm-col wm-left" id="wm-left"></div>
    <div class="wm-col wm-right" id="wm-right"></div>
  </div>
</div>

<!-- â”€â”€â”€ Gallery Screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="gallery" class="screen">
  <div class="top-bar w-full max-w">
    <button class="back-btn" onclick="goHome()" aria-label="Back to home">â†</button>
    <div class="gallery-heading">My Animals</div>
    <div class="gallery-count" id="gallery-count"></div>
  </div>
  <div id="gallery-grid" class="gallery-grid w-full max-w"></div>
</div>

<!-- â”€â”€â”€ Confetti container â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="confetti-container" id="confetti"></div>

<!-- â”€â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="toast" id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LETTER HUNT Â· Kapework
   Tiers 1â€“5: single letters, digraphs, blends (OG scope & sequence)
   Storage: localStorage only (Supabase to be added later)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

'use strict';

/* â”€â”€â”€ Audio â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let audioCtx = null;

function getAudioCtx() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}

function playTone(freq, duration, type = 'sine', gainVal = 0.4) {
  try {
    const ctx = getAudioCtx();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.type = type;
    osc.frequency.setValueAtTime(freq, ctx.currentTime);
    gain.gain.setValueAtTime(gainVal, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + duration);
  } catch (e) { /* audio not available */ }
}

function playChord(freqs, duration) {
  freqs.forEach((f, i) => {
    setTimeout(() => playTone(f, duration, 'sine', 0.3), i * 60);
  });
}

// Correct tap: bright chime
function soundCorrect() {
  playChord([523, 659, 784], 0.4);
}

// Incorrect tap: soft thud (low thump)
function soundIncorrect() {
  try {
    const ctx = getAudioCtx();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(120, ctx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(60, ctx.currentTime + 0.2);
    gain.gain.setValueAtTime(0.35, ctx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.25);
    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + 0.25);
  } catch (e) {}
}

// Round complete: rising arp
function soundRoundComplete() {
  const notes = [392, 494, 587, 698, 784];
  notes.forEach((f, i) => {
    setTimeout(() => playTone(f, 0.3, 'sine', 0.25), i * 90);
  });
}

// Session complete: full celebration
function soundSessionComplete() {
  const notes = [523, 659, 784, 1047, 1319];
  notes.forEach((f, i) => {
    setTimeout(() => playTone(f, 0.5, 'sine', 0.28), i * 100);
  });
  setTimeout(() => playChord([523, 659, 784], 0.8), 600);
}

/* â”€â”€â”€ Speech Synthesis â€” TTSPhonics engine â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
// Option B: speak an anchor keyword then cancel after cutMs so the child
// mainly hears the starting phoneme. Stop consonants (t, p, b, dâ€¦) use
// a bare syllable with no cutoff â€” more reliable on all TTS engines.

const PHONEMES = {
  // â”€â”€â”€ Tier 1 â€” Foundation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  s:  { text: 'snake',    cutMs: 230 },
  a:  { text: 'ant',      cutMs: 220 },
  t:  { text: 'tuh'                  },  // stop â€” no cut
  p:  { text: 'puh'                  },  // stop â€” no cut
  i:  { text: 'in',       cutMs: 200 },
  n:  { text: 'nose',     cutMs: 220 },
  // â”€â”€â”€ Tier 2 â€” Core â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  m:  { text: 'moon',     cutMs: 220 },
  d:  { text: 'duh'                  },
  g:  { text: 'guh'                  },
  o:  { text: 'octopus',  cutMs: 220 },
  c:  { text: 'kuh'                  },
  k:  { text: 'kuh'                  },
  e:  { text: 'egg',      cutMs: 200 },
  r:  { text: 'run',      cutMs: 200 },
  h:  { text: 'hat',      cutMs: 180 },
  b:  { text: 'buh'                  },
  u:  { text: 'up',       cutMs: 180 },
  l:  { text: 'lion',     cutMs: 220 },
  f:  { text: 'fish',     cutMs: 230 },
  // â”€â”€â”€ Tier 3 â€” Extended â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  j:  { text: 'juh'                  },
  w:  { text: 'wet',      cutMs: 200 },
  v:  { text: 'van',      cutMs: 200 },
  x:  { text: 'x-ray'                },
  y:  { text: 'yellow',   cutMs: 200 },
  z:  { text: 'zoo',      cutMs: 200 },
  q:  { text: 'queen',    cutMs: 220 },
  // â”€â”€â”€ Tier 4 â€” Digraphs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  sh: { text: 'ship',     cutMs: 230 },
  ch: { text: 'chair',    cutMs: 230 },
  th: { text: 'thumb',    cutMs: 230 },
  wh: { text: 'whale',    cutMs: 230 },
  ck: { text: 'kuh'                  },
  // â”€â”€â”€ Tier 5 â€” Blends â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  bl: { text: 'blue',     cutMs: 250 },
  cl: { text: 'clap',     cutMs: 250 },
  fl: { text: 'flag',     cutMs: 250 },
  br: { text: 'brush',    cutMs: 250 },
  cr: { text: 'crab',     cutMs: 250 },
  fr: { text: 'frog',     cutMs: 250 },
  st: { text: 'stop',     cutMs: 250 },
  sp: { text: 'spoon',    cutMs: 250 },
  gl: { text: 'glue',     cutMs: 250 },
  pl: { text: 'play',     cutMs: 250 },
  sl: { text: 'sleep',    cutMs: 250 },
  gr: { text: 'green',    cutMs: 250 },
  pr: { text: 'prize',    cutMs: 250 },
  tr: { text: 'truck',    cutMs: 250 },
  dr: { text: 'drum',     cutMs: 250 },
  sk: { text: 'skate',    cutMs: 250 },
  sn: { text: 'snail',    cutMs: 250 },
  sm: { text: 'smile',    cutMs: 250 },
  sw: { text: 'swim',     cutMs: 250 },
  tw: { text: 'twin',     cutMs: 250 },
};

class TTSPhonics {
  constructor({ ratePhoneme = 0.80, rateWord = 0.90, pitch = 1.00, volume = 1.00, lang = 'en-US' } = {}) {
    this.ratePhoneme = ratePhoneme;
    this.rateWord    = rateWord;
    this.pitch       = pitch;
    this.volume      = volume;
    this.lang        = lang;
    this.voice       = null;
    this.unlocked    = false;
    this._cutTimer   = null;
  }

  async init() {
    await this._ensureVoices();
    this.voice = this._pickEnglishVoice(this.lang);
  }

  // Call from a real user gesture so iOS Safari allows later non-gesture speech.
  unlockFromGesture() {
    if (this.unlocked) return;
    this.unlocked = true;
    if (!('speechSynthesis' in window)) return;
    try {
      const u = new SpeechSynthesisUtterance('unlock');
      u.volume = 0; u.rate = this.ratePhoneme; u.pitch = this.pitch; u.lang = this.lang;
      if (this.voice) u.voice = this.voice;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
      setTimeout(() => window.speechSynthesis.cancel(), 30);
    } catch (e) {}
  }

  playPhoneme(key) {
    const entry = PHONEMES[key];
    if (!entry) return false;
    return this._speak(entry.text, { cutMs: entry.cutMs ?? null, rate: this.ratePhoneme });
  }

  sayWord(word) {
    return this._speak(String(word), { cutMs: null, rate: this.rateWord });
  }

  stop() {
    if (!('speechSynthesis' in window)) return;
    if (this._cutTimer) { clearTimeout(this._cutTimer); this._cutTimer = null; }
    window.speechSynthesis.cancel();
  }

  _speak(text, { cutMs = null, rate = 0.9 } = {}) {
    if (!('speechSynthesis' in window)) return false;
    this.stop();
    const u = new SpeechSynthesisUtterance(text);
    u.rate = rate; u.pitch = this.pitch; u.volume = this.volume; u.lang = this.lang;
    if (this.voice) u.voice = this.voice;
    u.onstart = () => {
      if (cutMs != null) {
        this._cutTimer = setTimeout(() => { window.speechSynthesis.cancel(); this._cutTimer = null; }, cutMs);
      }
    };
    u.onend = u.onerror = () => {
      if (this._cutTimer) { clearTimeout(this._cutTimer); this._cutTimer = null; }
    };
    window.speechSynthesis.speak(u);
    return true;
  }

  async _ensureVoices() {
    if (!('speechSynthesis' in window)) return;
    const synth = window.speechSynthesis;
    if (synth.getVoices && synth.getVoices().length > 0) return;
    await new Promise(resolve => {
      let done = false;
      const finish = () => { if (!done) { done = true; synth.removeEventListener('voiceschanged', finish); resolve(); } };
      synth.addEventListener('voiceschanged', finish);
      setTimeout(finish, 600);
    });
  }

  _pickEnglishVoice(lang = 'en-US') {
    if (!window.speechSynthesis || !window.speechSynthesis.getVoices) return null;
    const voices = window.speechSynthesis.getVoices() || [];
    if (!voices.length) return null;
    return voices.find(v => (v.lang || '').toLowerCase() === lang.toLowerCase())
        || voices.find(v => (v.lang || '').toLowerCase().startsWith('en'))
        || voices[0] || null;
  }
}

const tts = new TTSPhonics();

// Thin wrapper kept for playLetterSound() call chain
function playLetterPhoneme(letter) { tts.playPhoneme(letter); }


/* â”€â”€â”€ Content Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

// Tier 1 letters with keyword hints and image sets
// Each item: { word, emoji, startsWith letter }
const TIER1 = {
  s: {
    hint: 'ğŸ snake',
    items: [
      { word: 'sun',    emoji: 'â˜€ï¸',  correct: true  },
      { word: 'sock',   emoji: 'ğŸ§¦',  correct: true  },
      { word: 'dog',    emoji: 'ğŸ•',  correct: false },
      { word: 'moon',   emoji: 'ğŸŒ™',  correct: false },
      { word: 'bird',   emoji: 'ğŸ¦',  correct: false },
      { word: 'train',  emoji: 'ğŸš‚',  correct: false },
      { word: 'star',   emoji: 'â­',  correct: true  }, // extra, not always shown
      { word: 'sheep',  emoji: 'ğŸ‘',  correct: true  }, // extra
    ]
  },
  a: {
    hint: 'ğŸ apple',
    items: [
      { word: 'ant',    emoji: 'ğŸœ',  correct: true  },
      { word: 'apple',  emoji: 'ğŸ',  correct: true  },
      { word: 'cat',    emoji: 'ğŸ±',  correct: false },
      { word: 'ball',   emoji: 'âš½',  correct: false },
      { word: 'fish',   emoji: 'ğŸŸ',  correct: false },
      { word: 'moon',   emoji: 'ğŸŒ™',  correct: false },
      { word: 'anchor', emoji: 'âš“',  correct: true  }, // extra
      { word: 'arrow',  emoji: 'ğŸ¹',  correct: true  }, // extra
    ]
  },
  t: {
    hint: 'ğŸ¯ tiger',
    items: [
      { word: 'tiger',  emoji: 'ğŸ¯',  correct: true  },
      { word: 'turtle', emoji: 'ğŸ¢',  correct: true  },
      { word: 'bike',   emoji: 'ğŸš²',  correct: false },
      { word: 'cup',    emoji: 'â˜•',  correct: false },
      { word: 'rain',   emoji: 'ğŸŒ§ï¸',  correct: false },
      { word: 'star',   emoji: 'â­',  correct: false },
      { word: 'truck',  emoji: 'ğŸšš',  correct: true  }, // extra
      { word: 'tree',   emoji: 'ğŸŒ³',  correct: true  }, // extra
    ]
  },
  p: {
    hint: 'ğŸ§ penguin',
    items: [
      { word: 'pig',    emoji: 'ğŸ·',  correct: true  },
      { word: 'pizza',  emoji: 'ğŸ•',  correct: true  },
      { word: 'dog',    emoji: 'ğŸ•',  correct: false },
      { word: 'tree',   emoji: 'ğŸŒ³',  correct: false },
      { word: 'cup',    emoji: 'â˜•',  correct: false },
      { word: 'fish',   emoji: 'ğŸŸ',  correct: false },
      { word: 'pear',   emoji: 'ğŸ',  correct: true  }, // extra
      { word: 'parrot', emoji: 'ğŸ¦œ',  correct: true  }, // extra
    ]
  },
  i: {
    hint: 'ğŸ¦‹ insect',
    items: [
      { word: 'igloo',  emoji: 'ğŸ”ï¸',  correct: true  },
      { word: 'insect', emoji: 'ğŸ›',  correct: true  },
      { word: 'dog',    emoji: 'ğŸ•',  correct: false },
      { word: 'train',  emoji: 'ğŸš‚',  correct: false },
      { word: 'moon',   emoji: 'ğŸŒ™',  correct: false },
      { word: 'ball',   emoji: 'âš½',  correct: false },
      { word: 'iron',   emoji: 'ğŸ”§',  correct: true  }, // extra
      { word: 'ink',    emoji: 'ğŸ–Šï¸',  correct: true  }, // extra
    ]
  },
  n: {
    hint: 'ğŸŒ™ night',
    items: [
      { word: 'net',    emoji: 'ğŸ•¸ï¸',  correct: true  },
      { word: 'nose',   emoji: 'ğŸ‘ƒ',  correct: true  },
      { word: 'dog',    emoji: 'ğŸ•',  correct: false },
      { word: 'apple',  emoji: 'ğŸ',  correct: false },
      { word: 'sun',    emoji: 'â˜€ï¸',  correct: false },
      { word: 'ball',   emoji: 'âš½',  correct: false },
      { word: 'nest',   emoji: 'ğŸªº',  correct: true  }, // extra
      { word: 'nut',    emoji: 'ğŸ¥œ',  correct: true  }, // extra
    ]
  }
};

const TIER2 = {
  m: {
    hint: 'ğŸŒ™ moon',
    items: [
      { word: 'moon',   emoji: 'ğŸŒ™', correct: true  },
      { word: 'milk',   emoji: 'ğŸ¥›', correct: true  },
      { word: 'mouse',  emoji: 'ğŸ­', correct: true  },
      { word: 'monkey', emoji: 'ğŸ’', correct: true  },
      { word: 'dog',    emoji: 'ğŸ•', correct: false },
      { word: 'apple',  emoji: 'ğŸ', correct: false },
      { word: 'sun',    emoji: 'â˜€ï¸', correct: false },
      { word: 'bird',   emoji: 'ğŸ¦', correct: false },
    ]
  },
  d: {
    hint: 'ğŸ¦† duck',
    items: [
      { word: 'dog',    emoji: 'ğŸ•', correct: true  },
      { word: 'duck',   emoji: 'ğŸ¦†', correct: true  },
      { word: 'drum',   emoji: 'ğŸ¥', correct: true  },
      { word: 'door',   emoji: 'ğŸšª', correct: true  },
      { word: 'cat',    emoji: 'ğŸ±', correct: false },
      { word: 'sun',    emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',   emoji: 'ğŸŸ', correct: false },
      { word: 'moon',   emoji: 'ğŸŒ™', correct: false },
    ]
  },
  g: {
    hint: 'ğŸ‡ grapes',
    items: [
      { word: 'goat',   emoji: 'ğŸ', correct: true  },
      { word: 'grapes', emoji: 'ğŸ‡', correct: true  },
      { word: 'gift',   emoji: 'ğŸ', correct: true  },
      { word: 'guitar', emoji: 'ğŸ¸', correct: true  },
      { word: 'dog',    emoji: 'ğŸ•', correct: false },
      { word: 'apple',  emoji: 'ğŸ', correct: false },
      { word: 'fish',   emoji: 'ğŸŸ', correct: false },
      { word: 'bird',   emoji: 'ğŸ¦', correct: false },
    ]
  },
  o: {
    hint: 'ğŸ™ octopus',
    items: [
      { word: 'octopus',emoji: 'ğŸ™', correct: true  },
      { word: 'orange', emoji: 'ğŸŠ', correct: true  },
      { word: 'otter',  emoji: 'ğŸ¦¦', correct: true  },
      { word: 'ox',     emoji: 'ğŸ‚', correct: true  },
      { word: 'cat',    emoji: 'ğŸ±', correct: false },
      { word: 'sun',    emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',   emoji: 'ğŸŸ', correct: false },
      { word: 'ball',   emoji: 'âš½', correct: false },
    ]
  },
  c: {
    hint: 'ğŸ„ cow',
    items: [
      { word: 'car',    emoji: 'ğŸš—', correct: true  },
      { word: 'cake',   emoji: 'ğŸ‚', correct: true  },
      { word: 'cow',    emoji: 'ğŸ„', correct: true  },
      { word: 'camel',  emoji: 'ğŸª', correct: true  },
      { word: 'dog',    emoji: 'ğŸ•', correct: false },
      { word: 'apple',  emoji: 'ğŸ', correct: false },
      { word: 'moon',   emoji: 'ğŸŒ™', correct: false },
      { word: 'fish',   emoji: 'ğŸŸ', correct: false },
    ]
  },
  k: {
    hint: 'ğŸª kite',
    items: [
      { word: 'key',    emoji: 'ğŸ—ï¸', correct: true  },
      { word: 'king',   emoji: 'ğŸ‘‘', correct: true  },
      { word: 'koala',  emoji: 'ğŸ¨', correct: true  },
      { word: 'kite',   emoji: 'ğŸª', correct: true  },
      { word: 'dog',    emoji: 'ğŸ•', correct: false },
      { word: 'apple',  emoji: 'ğŸ', correct: false },
      { word: 'sun',    emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',   emoji: 'ğŸŸ', correct: false },
    ]
  },
  e: {
    hint: 'ğŸ¥š egg',
    items: [
      { word: 'egg',      emoji: 'ğŸ¥š', correct: true  },
      { word: 'elephant', emoji: 'ğŸ˜', correct: true  },
      { word: 'envelope', emoji: 'âœ‰ï¸', correct: true  },
      { word: 'eagle',    emoji: 'ğŸ¦…', correct: true  },
      { word: 'dog',      emoji: 'ğŸ•', correct: false },
      { word: 'sun',      emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',     emoji: 'ğŸŸ', correct: false },
      { word: 'ball',     emoji: 'âš½', correct: false },
    ]
  },
  r: {
    hint: 'ğŸŒˆ rainbow',
    items: [
      { word: 'rabbit',  emoji: 'ğŸ°', correct: true  },
      { word: 'rainbow', emoji: 'ğŸŒˆ', correct: true  },
      { word: 'rocket',  emoji: 'ğŸš€', correct: true  },
      { word: 'ring',    emoji: 'ğŸ’', correct: true  },
      { word: 'dog',     emoji: 'ğŸ•', correct: false },
      { word: 'apple',   emoji: 'ğŸ', correct: false },
      { word: 'sun',     emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',    emoji: 'ğŸŸ', correct: false },
    ]
  },
  h: {
    hint: 'ğŸ  house',
    items: [
      { word: 'hat',   emoji: 'ğŸ©', correct: true  },
      { word: 'horse', emoji: 'ğŸ´', correct: true  },
      { word: 'heart', emoji: 'â¤ï¸', correct: true  },
      { word: 'house', emoji: 'ğŸ ', correct: true  },
      { word: 'dog',   emoji: 'ğŸ•', correct: false },
      { word: 'apple', emoji: 'ğŸ', correct: false },
      { word: 'sun',   emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',  emoji: 'ğŸŸ', correct: false },
    ]
  },
  b: {
    hint: 'ğŸ» bear',
    items: [
      { word: 'ball',  emoji: 'âš½', correct: true  },
      { word: 'bear',  emoji: 'ğŸ»', correct: true  },
      { word: 'bee',   emoji: 'ğŸ', correct: true  },
      { word: 'boat',  emoji: 'â›µ', correct: true  },
      { word: 'dog',   emoji: 'ğŸ•', correct: false },
      { word: 'apple', emoji: 'ğŸ', correct: false },
      { word: 'sun',   emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',  emoji: 'ğŸŸ', correct: false },
    ]
  },
  u: {
    hint: 'â˜‚ï¸ umbrella',
    items: [
      { word: 'umbrella',  emoji: 'ğŸŒ‚', correct: true  },
      { word: 'up',        emoji: 'â¬†ï¸', correct: true  },
      { word: 'underwear', emoji: 'ğŸ©²', correct: true  },
      { word: 'unicycle',  emoji: 'ğŸš²', correct: true  },
      { word: 'dog',       emoji: 'ğŸ•', correct: false },
      { word: 'apple',     emoji: 'ğŸ', correct: false },
      { word: 'sun',       emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',      emoji: 'ğŸŸ', correct: false },
    ]
  },
  l: {
    hint: 'ğŸ¦ lion',
    items: [
      { word: 'lamp',  emoji: 'ğŸª”', correct: true  },
      { word: 'lemon', emoji: 'ğŸ‹', correct: true  },
      { word: 'leaf',  emoji: 'ğŸƒ', correct: true  },
      { word: 'lion',  emoji: 'ğŸ¦', correct: true  },
      { word: 'dog',   emoji: 'ğŸ•', correct: false },
      { word: 'apple', emoji: 'ğŸ', correct: false },
      { word: 'sun',   emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',  emoji: 'ğŸŸ', correct: false },
    ]
  },
  f: {
    hint: 'ğŸ¸ frog',
    items: [
      { word: 'fish',   emoji: 'ğŸŸ', correct: true  },
      { word: 'flower', emoji: 'ğŸŒ¸', correct: true  },
      { word: 'fire',   emoji: 'ğŸ”¥', correct: true  },
      { word: 'frog',   emoji: 'ğŸ¸', correct: true  },
      { word: 'dog',    emoji: 'ğŸ•', correct: false },
      { word: 'apple',  emoji: 'ğŸ', correct: false },
      { word: 'sun',    emoji: 'â˜€ï¸', correct: false },
      { word: 'bird',   emoji: 'ğŸ¦', correct: false },
    ]
  },
};

const TIER3 = {
  j: {
    hint: 'ğŸª¼ jellyfish',
    items: [
      { word: 'jellyfish', emoji: 'ğŸª¼', correct: true  },
      { word: 'jar',       emoji: 'ğŸ«™', correct: true  },
      { word: 'juice',     emoji: 'ğŸ§ƒ', correct: true  },
      { word: 'jet',       emoji: 'âœˆï¸', correct: true  },
      { word: 'dog',       emoji: 'ğŸ•', correct: false },
      { word: 'apple',     emoji: 'ğŸ', correct: false },
      { word: 'sun',       emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',      emoji: 'ğŸŸ', correct: false },
    ]
  },
  w: {
    hint: 'ğŸ‹ whale',
    items: [
      { word: 'wolf',       emoji: 'ğŸº', correct: true  },
      { word: 'worm',       emoji: 'ğŸª±', correct: true  },
      { word: 'watermelon', emoji: 'ğŸ‰', correct: true  },
      { word: 'watch',      emoji: 'âŒš', correct: true  },
      { word: 'dog',        emoji: 'ğŸ•', correct: false },
      { word: 'apple',      emoji: 'ğŸ', correct: false },
      { word: 'sun',        emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',       emoji: 'ğŸŸ', correct: false },
    ]
  },
  v: {
    hint: 'ğŸŒ‹ volcano',
    items: [
      { word: 'violin',  emoji: 'ğŸ»', correct: true  },
      { word: 'volcano', emoji: 'ğŸŒ‹', correct: true  },
      { word: 'van',     emoji: 'ğŸš', correct: true  },
      { word: 'vampire', emoji: 'ğŸ§›', correct: true  },
      { word: 'dog',     emoji: 'ğŸ•', correct: false },
      { word: 'apple',   emoji: 'ğŸ', correct: false },
      { word: 'sun',     emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',    emoji: 'ğŸŸ', correct: false },
    ]
  },
  y: {
    hint: 'ğŸª€ yo-yo',
    items: [
      { word: 'yak',  emoji: 'ğŸ¦¬', correct: true  },
      { word: 'yo-yo',emoji: 'ğŸª€', correct: true  },
      { word: 'yawn', emoji: 'ğŸ¥±', correct: true  },
      { word: 'yacht',emoji: 'â›µ', correct: true  },
      { word: 'dog',  emoji: 'ğŸ•', correct: false },
      { word: 'apple',emoji: 'ğŸ', correct: false },
      { word: 'sun',  emoji: 'â˜€ï¸', correct: false },
      { word: 'fish', emoji: 'ğŸŸ', correct: false },
    ]
  },
  z: {
    hint: 'ğŸ¦“ zebra',
    items: [
      { word: 'zebra',    emoji: 'ğŸ¦“', correct: true  },
      { word: 'zero',     emoji: '0ï¸âƒ£', correct: true  },
      { word: 'zombie',   emoji: 'ğŸ§Ÿ', correct: true  },
      { word: 'zucchini', emoji: 'ğŸ¥’', correct: true  },
      { word: 'dog',      emoji: 'ğŸ•', correct: false },
      { word: 'apple',    emoji: 'ğŸ', correct: false },
      { word: 'sun',      emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',     emoji: 'ğŸŸ', correct: false },
    ]
  },
  q: {
    hint: 'ğŸ‘¸ queen',
    items: [
      { word: 'queen', emoji: 'ğŸ‘¸', correct: true  },
      { word: 'quill', emoji: 'âœï¸', correct: true  },
      { word: 'quail', emoji: 'ğŸ¦', correct: true  },
      { word: 'dog',   emoji: 'ğŸ•', correct: false },
      { word: 'apple', emoji: 'ğŸ', correct: false },
      { word: 'sun',   emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',  emoji: 'ğŸŸ', correct: false },
      { word: 'moon',  emoji: 'ğŸŒ™', correct: false },
    ]
  },
  x: {
    hint: 'ğŸ¦´ x-ray',
    items: [
      { word: 'x-ray',    emoji: 'ğŸ¦´', correct: true  },
      { word: 'xylophone',emoji: 'ğŸµ', correct: true  },
      { word: 'dog',      emoji: 'ğŸ•', correct: false },
      { word: 'apple',    emoji: 'ğŸ', correct: false },
      { word: 'sun',      emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',     emoji: 'ğŸŸ', correct: false },
      { word: 'bird',     emoji: 'ğŸ¦', correct: false },
      { word: 'moon',     emoji: 'ğŸŒ™', correct: false },
    ]
  },
};

const TIER4 = {
  sh: {
    hint: 'ğŸ‘ sheep',
    items: [
      { word: 'sheep', emoji: 'ğŸ‘', correct: true  },
      { word: 'ship',  emoji: 'ğŸš¢', correct: true  },
      { word: 'shell', emoji: 'ğŸš', correct: true  },
      { word: 'shark', emoji: 'ğŸ¦ˆ', correct: true  },
      { word: 'dog',   emoji: 'ğŸ•', correct: false },
      { word: 'apple', emoji: 'ğŸ', correct: false },
      { word: 'sun',   emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',  emoji: 'ğŸŸ', correct: false },
    ]
  },
  ch: {
    hint: 'ğŸ” chicken',
    items: [
      { word: 'cheese',  emoji: 'ğŸ§€', correct: true  },
      { word: 'cherry',  emoji: 'ğŸ’', correct: true  },
      { word: 'chicken', emoji: 'ğŸ”', correct: true  },
      { word: 'chair',   emoji: 'ğŸª‘', correct: true  },
      { word: 'dog',     emoji: 'ğŸ•', correct: false },
      { word: 'apple',   emoji: 'ğŸ', correct: false },
      { word: 'sun',     emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',    emoji: 'ğŸŸ', correct: false },
    ]
  },
  th: {
    hint: 'ğŸ‘ thumb',
    items: [
      { word: 'thumb',        emoji: 'ğŸ‘', correct: true  },
      { word: 'thermometer',  emoji: 'ğŸŒ¡ï¸', correct: true  },
      { word: 'thought',      emoji: 'ğŸ’­', correct: true  },
      { word: 'three',        emoji: '3ï¸âƒ£', correct: true  },
      { word: 'dog',          emoji: 'ğŸ•', correct: false },
      { word: 'apple',        emoji: 'ğŸ', correct: false },
      { word: 'sun',          emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',         emoji: 'ğŸŸ', correct: false },
    ]
  },
  wh: {
    hint: 'ğŸ‹ whale',
    items: [
      { word: 'whale',  emoji: 'ğŸ‹', correct: true  },
      { word: 'wheel',  emoji: 'ğŸ¡', correct: true  },
      { word: 'wheat',  emoji: 'ğŸŒ¾', correct: true  },
      { word: 'whistle',emoji: 'ğŸ“¯', correct: true  },
      { word: 'dog',    emoji: 'ğŸ•', correct: false },
      { word: 'apple',  emoji: 'ğŸ', correct: false },
      { word: 'sun',    emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',   emoji: 'ğŸŸ', correct: false },
    ]
  },
};

const TIER5 = {
  bl: {
    hint: 'ğŸ« blueberry',
    items: [
      { word: 'blueberry', emoji: 'ğŸ«', correct: true  },
      { word: 'blanket',   emoji: 'ğŸ›ï¸', correct: true  },
      { word: 'block',     emoji: 'ğŸ§±', correct: true  },
      { word: 'blade',     emoji: 'ğŸ”ª', correct: true  },
      { word: 'dog',       emoji: 'ğŸ•', correct: false },
      { word: 'apple',     emoji: 'ğŸ', correct: false },
      { word: 'sun',       emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',      emoji: 'ğŸŸ', correct: false },
    ]
  },
  cl: {
    hint: 'â˜ï¸ cloud',
    items: [
      { word: 'cloud', emoji: 'â˜ï¸', correct: true  },
      { word: 'clock', emoji: 'ğŸ•', correct: true  },
      { word: 'clown', emoji: 'ğŸ¤¡', correct: true  },
      { word: 'clap',  emoji: 'ğŸ‘', correct: true  },
      { word: 'dog',   emoji: 'ğŸ•', correct: false },
      { word: 'apple', emoji: 'ğŸ', correct: false },
      { word: 'sun',   emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',  emoji: 'ğŸŸ', correct: false },
    ]
  },
  fl: {
    hint: 'ğŸ¦© flamingo',
    items: [
      { word: 'flower',   emoji: 'ğŸŒ¸', correct: true  },
      { word: 'flag',     emoji: 'ğŸš©', correct: true  },
      { word: 'flamingo', emoji: 'ğŸ¦©', correct: true  },
      { word: 'flash',    emoji: 'âš¡', correct: true  },
      { word: 'dog',      emoji: 'ğŸ•', correct: false },
      { word: 'apple',    emoji: 'ğŸ', correct: false },
      { word: 'sun',      emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',     emoji: 'ğŸŸ', correct: false },
    ]
  },
  br: {
    hint: 'ğŸ bread',
    items: [
      { word: 'bread',  emoji: 'ğŸ', correct: true  },
      { word: 'broom',  emoji: 'ğŸ§¹', correct: true  },
      { word: 'brain',  emoji: 'ğŸ§ ', correct: true  },
      { word: 'bridge', emoji: 'ğŸŒ‰', correct: true  },
      { word: 'dog',    emoji: 'ğŸ•', correct: false },
      { word: 'apple',  emoji: 'ğŸ', correct: false },
      { word: 'sun',    emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',   emoji: 'ğŸŸ', correct: false },
    ]
  },
  cr: {
    hint: 'ğŸ¦€ crab',
    items: [
      { word: 'crab',       emoji: 'ğŸ¦€', correct: true  },
      { word: 'crown',      emoji: 'ğŸ‘‘', correct: true  },
      { word: 'crayon',     emoji: 'ğŸ–ï¸', correct: true  },
      { word: 'crocodile',  emoji: 'ğŸŠ', correct: true  },
      { word: 'dog',        emoji: 'ğŸ•', correct: false },
      { word: 'apple',      emoji: 'ğŸ', correct: false },
      { word: 'sun',        emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',       emoji: 'ğŸŸ', correct: false },
    ]
  },
  fr: {
    hint: 'ğŸ¸ frog',
    items: [
      { word: 'frog',        emoji: 'ğŸ¸', correct: true  },
      { word: 'french fries',emoji: 'ğŸŸ', correct: true  },
      { word: 'frame',       emoji: 'ğŸ–¼ï¸', correct: true  },
      { word: 'fruit',       emoji: 'ğŸ“', correct: true  },
      { word: 'dog',         emoji: 'ğŸ•', correct: false },
      { word: 'apple',       emoji: 'ğŸ', correct: false },
      { word: 'sun',         emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',        emoji: 'ğŸŸ', correct: false },
    ]
  },
  st: {
    hint: 'â­ star',
    items: [
      { word: 'star',       emoji: 'â­', correct: true  },
      { word: 'strawberry', emoji: 'ğŸ“', correct: true  },
      { word: 'stone',      emoji: 'ğŸª¨', correct: true  },
      { word: 'stamp',      emoji: 'ğŸ“®', correct: true  },
      { word: 'dog',        emoji: 'ğŸ•', correct: false },
      { word: 'apple',      emoji: 'ğŸ', correct: false },
      { word: 'moon',       emoji: 'ğŸŒ™', correct: false },
      { word: 'fish',       emoji: 'ğŸŸ', correct: false },
    ]
  },
  sp: {
    hint: 'ğŸ•·ï¸ spider',
    items: [
      { word: 'spider',    emoji: 'ğŸ•·ï¸', correct: true  },
      { word: 'spoon',     emoji: 'ğŸ¥„', correct: true  },
      { word: 'spaceship', emoji: 'ğŸš€', correct: true  },
      { word: 'spaghetti', emoji: 'ğŸ', correct: true  },
      { word: 'dog',       emoji: 'ğŸ•', correct: false },
      { word: 'apple',     emoji: 'ğŸ', correct: false },
      { word: 'sun',       emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',      emoji: 'ğŸŸ', correct: false },
    ]
  },
  tr: {
    hint: 'ğŸŒ³ tree',
    items: [
      { word: 'truck',   emoji: 'ğŸšš', correct: true  },
      { word: 'tree',    emoji: 'ğŸŒ³', correct: true  },
      { word: 'train',   emoji: 'ğŸš‚', correct: true  },
      { word: 'trophy',  emoji: 'ğŸ†', correct: true  },
      { word: 'dog',     emoji: 'ğŸ•', correct: false },
      { word: 'apple',   emoji: 'ğŸ', correct: false },
      { word: 'sun',     emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',    emoji: 'ğŸŸ', correct: false },
    ]
  },
  dr: {
    hint: 'ğŸ¥ drum',
    items: [
      { word: 'drum',       emoji: 'ğŸ¥', correct: true  },
      { word: 'dragon',     emoji: 'ğŸ‰', correct: true  },
      { word: 'dress',      emoji: 'ğŸ‘—', correct: true  },
      { word: 'dragonfly',  emoji: 'ğŸª²', correct: true  },
      { word: 'dog',        emoji: 'ğŸ•', correct: false },
      { word: 'apple',      emoji: 'ğŸ', correct: false },
      { word: 'sun',        emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',       emoji: 'ğŸŸ', correct: false },
    ]
  },
  gr: {
    hint: 'ğŸ‡ grapes',
    items: [
      { word: 'grapes',    emoji: 'ğŸ‡', correct: true  },
      { word: 'grass',     emoji: 'ğŸŒ¿', correct: true  },
      { word: 'grandma',   emoji: 'ğŸ‘µ', correct: true  },
      { word: 'grapefruit',emoji: 'ğŸŠ', correct: true  },
      { word: 'dog',       emoji: 'ğŸ•', correct: false },
      { word: 'apple',     emoji: 'ğŸ', correct: false },
      { word: 'sun',       emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',      emoji: 'ğŸŸ', correct: false },
    ]
  },
  pl: {
    hint: 'âœˆï¸ plane',
    items: [
      { word: 'plane', emoji: 'âœˆï¸', correct: true  },
      { word: 'plant', emoji: 'ğŸŒ±', correct: true  },
      { word: 'plate', emoji: 'ğŸ½ï¸', correct: true  },
      { word: 'plum',  emoji: 'ğŸ«', correct: true  },
      { word: 'dog',   emoji: 'ğŸ•', correct: false },
      { word: 'apple', emoji: 'ğŸ', correct: false },
      { word: 'sun',   emoji: 'â˜€ï¸', correct: false },
      { word: 'fish',  emoji: 'ğŸŸ', correct: false },
    ]
  },
};

// All tiers merged â€” session builder draws from this flat pool
const ALL_LETTERS = { ...TIER1, ...TIER2, ...TIER3, ...TIER4, ...TIER5 };

// Collectible cards pool
const CARDS = [
  { emoji: 'ğŸ¦', name: 'Lion',      rarity: 'standard' },
  { emoji: 'ğŸ˜', name: 'Elephant',  rarity: 'standard' },
  { emoji: 'ğŸ¦Š', name: 'Fox',       rarity: 'standard' },
  { emoji: 'ğŸ¬', name: 'Dolphin',   rarity: 'standard' },
  { emoji: 'ğŸ¦’', name: 'Giraffe',   rarity: 'standard' },
  { emoji: 'ğŸ§', name: 'Penguin',   rarity: 'standard' },
  { emoji: 'ğŸ¦œ', name: 'Parrot',    rarity: 'standard' },
  { emoji: 'ğŸ¯', name: 'Tiger',     rarity: 'standard' },
  { emoji: 'ğŸ¦‹', name: 'Butterfly', rarity: 'standard' },
  { emoji: 'ğŸº', name: 'Wolf',      rarity: 'standard' },
  { emoji: 'ğŸ¦…', name: 'Eagle',     rarity: 'rare'     },
  { emoji: 'ğŸ¦„', name: 'Unicorn',   rarity: 'rare'     },
  { emoji: 'ğŸ‰', name: 'Dragon',    rarity: 'rare'     },
  { emoji: 'ğŸ¦š', name: 'Peacock',   rarity: 'rare'     },
];

/* â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const ROUNDS_PER_SESSION = 5;

let state = {
  // Session
  currentRound: 0,          // 0-indexed
  rounds: [],               // built at session start
  totalIncorrect: 0,
  sessionStartTime: null,
  // Round
  foundCorrect: 0,
  roundIncorrect: 0,
  tapCounts: {},            // itemWord -> tap count
  // Progress (from localStorage)
  streak: 0,
  lastPlayDate: null,
  todayDone: false,
  todayStars: 0,
  earnedCard: null,
  earnedCards: [],    // persistent collection across all days
  // Sight Word Dash
  swMastery:    {},   // word â†’ cumulative points (persistent)
  swTodayDone:  false,
  swTodayStars: 0,
  swEarnedCard: null,
  // Word Match
  wmTodayDone:  false,
  wmTodayStars: 0,
  wmEarnedCard: null,
};

/* â”€â”€â”€ LocalStorage helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const LS_KEY = 'kapework_lh_v1';

function loadProgress() {
  try {
    const raw = localStorage.getItem(LS_KEY);
    if (!raw) return;
    const data = JSON.parse(raw);
    state.streak         = data.streak ?? 0;
    state.lastPlayDate   = data.lastPlayDate ?? null;
    state.todayDone      = data.todayDone ?? false;
    state.todayStars     = data.todayStars ?? 0;
    state.earnedCard     = data.earnedCard  ?? null;
    state.earnedCards    = data.earnedCards ?? [];   // persists across days
    state.swMastery      = data.swMastery   ?? {};   // persists across days
    state.swTodayDone    = data.swTodayDone  ?? false;
    state.swTodayStars   = data.swTodayStars ?? 0;
    state.swEarnedCard   = data.swEarnedCard ?? null;
    state.wmTodayDone    = data.wmTodayDone  ?? false;
    state.wmTodayStars   = data.wmTodayStars ?? 0;
    state.wmEarnedCard   = data.wmEarnedCard ?? null;
    // Check if "today" in stored data is still today
    const today = getTodayStr();
    if (data.lastPlayDate !== today) {
      state.todayDone   = false;
      state.todayStars  = 0;
      state.earnedCard  = null;
      state.swTodayDone  = false;
      state.swTodayStars = 0;
      state.swEarnedCard = null;
      state.wmTodayDone  = false;
      state.wmTodayStars = 0;
      state.wmEarnedCard = null;
      // Do NOT reset earnedCards or swMastery â€” those persist
    }
    // Streak: if last played was >1 day ago, and no shield, reset
    if (state.lastPlayDate) {
      const daysSince = daysBetween(state.lastPlayDate, today);
      if (daysSince > 1) {
        state.streak = 0;
      }
    }
  } catch (e) { /* corrupt storage, ignore */ }
}

function saveProgress() {
  try {
    localStorage.setItem(LS_KEY, JSON.stringify({
      streak:        state.streak,
      lastPlayDate:  state.lastPlayDate,
      todayDone:     state.todayDone,
      todayStars:    state.todayStars,
      earnedCard:    state.earnedCard,
      earnedCards:   state.earnedCards,
      swMastery:     state.swMastery,
      swTodayDone:   state.swTodayDone,
      swTodayStars:  state.swTodayStars,
      swEarnedCard:  state.swEarnedCard,
      wmTodayDone:   state.wmTodayDone,
      wmTodayStars:  state.wmTodayStars,
      wmEarnedCard:  state.wmEarnedCard,
    }));
  } catch (e) {}
}

function getTodayStr() {
  const d = new Date();
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}

function daysBetween(a, b) {
  const msPerDay = 86400000;
  const dateA = new Date(a);
  const dateB = new Date(b);
  return Math.round(Math.abs(dateB - dateA) / msPerDay);
}

function formatDate(str) {
  const [y, m, d] = str.split('-').map(Number);
  const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  return `${months[m-1]} ${d}, ${y}`;
}

/* â”€â”€â”€ Session builder â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function buildSession() {
  // Pick 5 letters/digraphs/blends from all tiers, seeded by date
  const letters = Object.keys(ALL_LETTERS);
  const today = getTodayStr();
  const seed  = dateHash(today);

  // Shuffle letters using seed, take first ROUNDS_PER_SESSION
  const shuffled = seededShuffle([...letters], seed);
  const chosen   = shuffled.slice(0, ROUNDS_PER_SESSION);

  return chosen.map(letter => {
    const data    = ALL_LETTERS[letter];
    const correct = data.items.filter(i => i.correct);
    const wrong   = data.items.filter(i => !i.correct);

    // Pick 2 correct items
    const corrItems = seededShuffle(correct, seed + letter.charCodeAt(0)).slice(0, 2);
    // Pick 4 wrong items
    const wronItems = seededShuffle(wrong,   seed + letter.charCodeAt(0) + 7).slice(0, 4);

    // Merge and shuffle
    const all = seededShuffle([...corrItems, ...wronItems], seed + letter.charCodeAt(0) + 13);

    return { letter, hint: data.hint, items: all };
  });
}

function dateHash(str) {
  let h = 0;
  for (let i = 0; i < str.length; i++) {
    h = ((h << 5) - h + str.charCodeAt(i)) | 0;
  }
  return Math.abs(h);
}

function seededShuffle(arr, seed) {
  const a = [...arr];
  let s = seed;
  for (let i = a.length - 1; i > 0; i--) {
    s = (s * 1664525 + 1013904223) >>> 0;
    const j = s % (i + 1);
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

/* â”€â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function goHome() {
  updateHomeUI();
  showScreen('home');
}

function updateHomeUI() {
  document.getElementById('home-streak').textContent = state.streak;

  // Letter Hunt card
  const lhCard   = document.getElementById('lh-card');
  const lhStatus = document.getElementById('lh-status');
  if (state.todayDone) {
    lhCard.classList.remove('ready'); lhCard.classList.add('done');
    lhStatus.className   = 'mode-status stars';
    lhStatus.textContent = 'â­'.repeat(state.todayStars) || 'âœ“';
    lhCard.onclick = () => showTodaySummary();
  } else {
    lhCard.classList.add('ready'); lhCard.classList.remove('done');
    lhStatus.className   = 'mode-status play';
    lhStatus.textContent = 'Play';
    lhCard.onclick = startLetterHunt;
  }

  // Sight Word Dash card
  const swCard   = document.getElementById('sw-card');
  const swStatus = document.getElementById('sw-status');
  if (swCard) {
    if (state.swTodayDone) {
      swCard.classList.remove('ready'); swCard.classList.add('done');
      swStatus.className   = 'mode-status stars';
      swStatus.textContent = 'â­'.repeat(state.swTodayStars) || 'âœ“';
      swCard.onclick = () => showTodaySWSummary();
    } else {
      swCard.classList.add('ready'); swCard.classList.remove('done');
      swStatus.className   = 'mode-status play';
      swStatus.textContent = 'Play';
      swCard.onclick = startSightWordDash;
    }
  }

  // Word Match card
  const wmCard   = document.getElementById('wm-card');
  const wmStatus = document.getElementById('wm-status');
  if (wmCard) {
    if (state.wmTodayDone) {
      wmCard.classList.remove('ready'); wmCard.classList.add('done');
      wmStatus.className   = 'mode-status stars';
      wmStatus.textContent = 'â­'.repeat(state.wmTodayStars) || 'âœ“';
      wmCard.onclick = () => showTodayWMSummary();
    } else {
      wmCard.classList.add('ready'); wmCard.classList.remove('done');
      wmStatus.className   = 'mode-status play';
      wmStatus.textContent = 'Play';
      wmCard.onclick = startWordMatch;
    }
  }
}

/* â”€â”€â”€ Letter Hunt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function startLetterHunt() {
  if (state.todayDone) { showTodaySummary(); return; }

  // Unlock audio/speech on iOS (must come from user gesture)
  if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
  tts.unlockFromGesture();

  // Build rounds
  state.rounds            = buildSession();
  state.currentRound      = 0;
  state.totalIncorrect    = 0;
  state.sessionStartTime  = Date.now();

  showScreen('game');
  document.getElementById('game-streak').textContent = state.streak;

  loadRound(0);
}

function loadRound(index, animate = false) {
  const round = state.rounds[index];
  if (!round) return;

  // Reset round state
  state.foundCorrect  = 0;
  state.roundIncorrect = 0;
  state.tapCounts     = {};

  // Round dots
  buildRoundDots(index);

  // Letter zone
  document.getElementById('letter-chars').textContent = `${round.letter.toUpperCase()} ${round.letter}`;
  document.getElementById('letter-hint').textContent   = round.hint;

  // Grid (with animation)
  const grid = document.getElementById('picture-grid');

  const renderGrid = () => {
    grid.innerHTML = '';
    round.items.forEach(item => {
      const card = document.createElement('div');
      card.className = 'pic-card';
      card.dataset.word   = item.word;
      card.dataset.correct = item.correct ? '1' : '0';

      card.innerHTML = `
        <span class="pic-emoji">${item.emoji}</span>
        <span class="pic-check">âœ“</span>
      `;
      card.addEventListener('click', () => onCardTap(card, item));
      grid.appendChild(card);
    });
    if (animate) {
      grid.classList.remove('slide-out');
      grid.classList.add('slide-in');
      grid.addEventListener('animationend', () => grid.classList.remove('slide-in'), { once: true });
    }
  };

  if (animate) {
    grid.classList.add('slide-out');
    grid.addEventListener('animationend', () => { renderGrid(); }, { once: true });
  } else {
    renderGrid();
  }

  // Auto-play letter sound
  setTimeout(() => playLetterSound(), 400);
}

function buildRoundDots(currentIndex) {
  const container = document.getElementById('round-dots');
  container.innerHTML = '';
  for (let i = 0; i < ROUNDS_PER_SESSION; i++) {
    const dot = document.createElement('div');
    dot.className = 'dot' +
      (i < currentIndex  ? ' done'    : '') +
      (i === currentIndex ? ' current' : '');
    container.appendChild(dot);
  }
}

function onCardTap(card, item) {
  if (card.classList.contains('correct') || card.classList.contains('locked-out')) return;

  // Unlock audio/speech on first tap (iOS)
  try {
    const ctx = getAudioCtx();
    if (ctx.state === 'suspended') ctx.resume();
  } catch(e) {}
  tts.unlockFromGesture();

  const word = item.word;
  state.tapCounts[word] = (state.tapCounts[word] || 0) + 1;

  if (item.correct) {
    card.classList.add('correct');
    soundCorrect();
    tts.sayWord(item.word);
    state.foundCorrect++;

    // Check round complete
    if (state.foundCorrect === 2) {
      setTimeout(() => onRoundComplete(), 600);
    }
  } else {
    state.totalIncorrect++;
    state.roundIncorrect++;
    soundIncorrect();

    card.classList.add('shake');
    card.addEventListener('animationend', () => card.classList.remove('shake'), { once: true });

    if (state.tapCounts[word] >= 2) {
      card.classList.add('locked-out');
    }
  }
}

function playLetterSound() {
  const btn = document.getElementById('speaker-btn');
  btn.classList.add('playing');
  btn.addEventListener('animationend', () => btn.classList.remove('playing'), { once: true });

  const round = state.rounds[state.currentRound];
  if (round) playLetterPhoneme(round.letter);
}

function onRoundComplete() {
  soundRoundComplete();
  spawnConfetti(8);

  const next = state.currentRound + 1;

  if (next >= ROUNDS_PER_SESSION) {
    setTimeout(() => onSessionComplete(), 1200);
  } else {
    state.currentRound = next;
    setTimeout(() => loadRound(next, true), 1000);
  }
}

/* â”€â”€â”€ Session complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function onSessionComplete() {
  const duration = Math.round((Date.now() - state.sessionStartTime) / 1000);

  // Calculate stars
  let stars;
  if (state.totalIncorrect === 0) {
    stars = duration < 90 ? 3 : 2;  // fast = 3 stars, any time correct = 2
  } else if (state.totalIncorrect <= 3) {
    stars = 1;
  } else {
    stars = 0;
  }

  // Update streak
  const today = getTodayStr();
  if (state.lastPlayDate !== today) {
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yStr = `${yesterday.getFullYear()}-${String(yesterday.getMonth()+1).padStart(2,'0')}-${String(yesterday.getDate()).padStart(2,'0')}`;
    if (state.lastPlayDate === yStr || !state.lastPlayDate) {
      state.streak++;
    } else {
      state.streak = 1;
    }
    state.lastPlayDate = today;
  }

  // Pick collectible card (seeded by date + stars)
  const seed = dateHash(today + stars);
  const pool = stars >= 2
    ? CARDS.filter(c => c.rarity === 'rare')
    : CARDS.filter(c => c.rarity === 'standard');
  const card = pool[seed % pool.length];

  state.todayDone  = true;
  state.todayStars = stars;
  state.earnedCard = card;

  // Add to permanent collection
  if (!state.earnedCards.includes(card.name)) {
    state.earnedCards.push(card.name);
  }

  saveProgress();
  showSummary(stars, card);
}

/* â”€â”€â”€ Summary screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let summaryMode = 'lh'; // 'lh' | 'sw' | 'wm' â€” used by shareResult()

function showSummary(stars, card) {
  summaryMode = 'lh';
  showScreen('summary');
  soundSessionComplete();
  spawnConfetti(25);

  // Title / date
  const titles = ['Keep practicing!', 'Great job!', 'Excellent!', 'Perfect!'];
  document.getElementById('summary-title').textContent = titles[Math.min(stars, 3)];
  document.getElementById('summary-date').textContent  = formatDate(getTodayStr());

  // Stars (animate in sequence)
  ['star1','star2','star3'].forEach((id, i) => {
    const el = document.getElementById(id);
    el.classList.remove('earned');
    if (i < stars) {
      setTimeout(() => el.classList.add('earned'), 300 + i * 250);
    }
  });

  // Star label
  const labels = ['Keep practicing! âœ¨', 'Great job! ğŸ‰', 'Excellent! ğŸŒŸ', 'Perfect! ğŸ†'];
  document.getElementById('star-label').textContent = labels[Math.min(stars, 3)];

  // Card
  const cardEl = document.getElementById('card-reveal');
  cardEl.className = 'card-reveal' + (card.rarity === 'rare' ? ' rare' : '');
  document.getElementById('card-emoji').textContent = card.emoji;
  document.getElementById('card-name').textContent  = card.name;
  document.getElementById('card-rarity').textContent = card.rarity === 'rare' ? 'âœ¨ Rare card!' : "Today's card";

  // Streak
  document.getElementById('summary-streak-count').textContent = state.streak;
}

function showTodaySummary() {
  const card = state.earnedCard || CARDS[0];
  showSummary(state.todayStars, card);
}

/* â”€â”€â”€ Share â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function shareResult() {
  const date   = formatDate(getTodayStr());
  const streak = state.streak;
  const isSW   = (summaryMode === 'sw');
  const isWM   = (summaryMode === 'wm');
  const stars  = 'â­'.repeat(isWM ? state.wmTodayStars : isSW ? state.swTodayStars : state.todayStars) || 'âœ“';
  const game   = isWM ? 'Word Match' : isSW ? 'Sight Word Dash' : 'Letter Hunt';
  const text   = `${stars} ${game} â€” ${date} â€” Streak: ${streak} ğŸ”¥\nKapework Â· letterhunt.kapework.com`;

  if (navigator.share) {
    navigator.share({ text }).catch(() => copyToClipboard(text));
  } else {
    copyToClipboard(text);
  }
}

function copyToClipboard(text) {
  if (navigator.clipboard) {
    navigator.clipboard.writeText(text).then(() => showToast('Copied to clipboard!'));
  } else {
    const ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed';
    ta.style.opacity  = '0';
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    ta.remove();
    showToast('Copied to clipboard!');
  }
}

/* â”€â”€â”€ Confetti â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const CONFETTI_COLORS = ['#00e5cc','#4ade80','#ffd700','#ff6b35','#e8edf5','#a78bfa'];

function spawnConfetti(count) {
  const container = document.getElementById('confetti');
  for (let i = 0; i < count; i++) {
    const el = document.createElement('div');
    el.className = 'confetti-piece';
    el.style.left            = `${10 + Math.random() * 80}%`;
    el.style.top             = `${-10}px`;
    el.style.backgroundColor = CONFETTI_COLORS[Math.floor(Math.random() * CONFETTI_COLORS.length)];
    el.style.width           = `${6 + Math.random() * 8}px`;
    el.style.height          = `${6 + Math.random() * 8}px`;
    el.style.borderRadius    = Math.random() > 0.5 ? '50%' : '2px';
    el.style.animationDelay  = `${Math.random() * 0.4}s`;
    el.style.animationDuration = `${0.9 + Math.random() * 0.6}s`;
    container.appendChild(el);
    el.addEventListener('animationend', () => el.remove());
  }
}

/* â”€â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let toastTimer = null;

function showToast(msg, duration = 2000) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('visible');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('visible'), duration);
}

/* â”€â”€â”€ Sight Word Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const SW_WORDS_PER_SESSION = 8;

// Pre-Primer Dolch words. Distractors share first letter, length, or ending
// to force genuine recognition rather than shape-guessing.
const SIGHT_WORD_TIERS = {
  pre_primer: [
    { word: 'a',      distractors: ['I',      'an',     'at'    ] },
    { word: 'and',    distractors: ['ant',    'any',    'add'   ] },
    { word: 'away',   distractors: ['say',    'stay',   'way'   ] },
    { word: 'big',    distractors: ['bag',    'bit',    'pig'   ] },
    { word: 'blue',   distractors: ['clue',   'glue',   'blow'  ] },
    { word: 'can',    distractors: ['cat',    'cap',    'cup'   ] },
    { word: 'come',   distractors: ['some',   'came',   'home'  ] },
    { word: 'down',   distractors: ['town',   'dawn',   'gown'  ] },
    { word: 'find',   distractors: ['fine',   'kind',   'mind'  ] },
    { word: 'for',    distractors: ['far',    'fun',    'from'  ] },
    { word: 'funny',  distractors: ['bunny',  'sunny',  'fan'   ] },
    { word: 'go',     distractors: ['do',     'so',     'got'   ] },
    { word: 'help',   distractors: ['felt',   'heap',   'held'  ] },
    { word: 'here',   distractors: ['were',   'hare',   'her'   ] },
    { word: 'I',      distractors: ['in',     'it',     'is'    ] },
    { word: 'in',     distractors: ['it',     'is',     'an'    ] },
    { word: 'is',     distractors: ['it',     'in',     'as'    ] },
    { word: 'it',     distractors: ['is',     'in',     'at'    ] },
    { word: 'jump',   distractors: ['dump',   'pump',   'lump'  ] },
    { word: 'little', distractors: ['bottle', 'middle', 'rattle'] },
    { word: 'look',   distractors: ['took',   'book',   'loop'  ] },
    { word: 'make',   distractors: ['lake',   'fake',   'take'  ] },
    { word: 'me',     distractors: ['my',     'be',     'we'    ] },
    { word: 'my',     distractors: ['me',     'by',     'may'   ] },
    { word: 'not',    distractors: ['hot',    'got',    'lot'   ] },
    { word: 'one',    distractors: ['bone',   'tone',   'once'  ] },
    { word: 'play',   distractors: ['clay',   'slay',   'plan'  ] },
    { word: 'red',    distractors: ['rod',    'led',    'bed'   ] },
    { word: 'run',    distractors: ['sun',    'fun',    'bun'   ] },
    { word: 'said',   distractors: ['sail',   'sand',   'seed'  ] },
    { word: 'see',    distractors: ['sea',    'bee',    'fee'   ] },
    { word: 'the',    distractors: ['then',   'they',   'this'  ] },
    { word: 'three',  distractors: ['tree',   'free',   'threw' ] },
    { word: 'to',     distractors: ['too',    'do',     'two'   ] },
    { word: 'two',    distractors: ['too',    'to',     'ten'   ] },
    { word: 'up',     distractors: ['us',     'cup',    'pup'   ] },
    { word: 'we',     distractors: ['me',     'be',     'he'    ] },
    { word: 'where',  distractors: ['there',  'were',   'when'  ] },
    { word: 'yellow', distractors: ['fellow', 'mellow', 'yell'  ] },
    { word: 'you',    distractors: ['our',    'four',   'your'  ] },
  ],
};

/* â”€â”€â”€ Sight Word Dash â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let swSession = null;

function buildSWSession() {
  const tier  = SIGHT_WORD_TIERS.pre_primer;
  const today = getTodayStr();
  const seed  = dateHash(today + 'sw');

  // Prioritise less-mastered words; within each group shuffle with date seed
  const withPts = tier.map(w => ({ ...w, pts: state.swMastery[w.word] ?? 0 }));
  const pool = [
    ...seededShuffle(withPts.filter(w => w.pts <  10), seed),
    ...seededShuffle(withPts.filter(w => w.pts >= 10), seed + 1),
  ];

  const chosen = pool.slice(0, SW_WORDS_PER_SESSION);
  return {
    words: chosen.map(item => {
      const options = seededShuffle(
        [item.word, ...item.distractors],
        seed + item.word.length + item.word.charCodeAt(0)
      );
      return { word: item.word, options, taps: 0, solved: false };
    }),
    currentIdx:     0,
    totalIncorrect: 0,
    sessionStartTime: Date.now(),
    fadeTimer:      null,
  };
}

function startSightWordDash() {
  if (state.swTodayDone) { showTodaySWSummary(); return; }
  if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
  tts.unlockFromGesture();

  swSession = buildSWSession();
  showScreen('sw-game');
  document.getElementById('sw-game-streak').textContent = state.streak;
  loadSWWord(0);
}

function buildSWDots(currentIdx) {
  const container = document.getElementById('sw-dots');
  container.innerHTML = '';
  for (let i = 0; i < SW_WORDS_PER_SESSION; i++) {
    const dot = document.createElement('div');
    dot.className = 'dot' +
      (i < currentIdx   ? ' done'    : '') +
      (i === currentIdx ? ' current' : '');
    container.appendChild(dot);
  }
}

function loadSWWord(idx, animate = false) {
  if (!swSession) return;
  swSession.currentIdx = idx;
  const entry = swSession.words[idx];
  if (!entry) return;

  buildSWDots(idx);

  const wordEl = document.getElementById('sw-word');
  wordEl.textContent = entry.word;
  wordEl.classList.remove('faded');

  // Clear any existing fade timer
  if (swSession.fadeTimer) { clearTimeout(swSession.fadeTimer); swSession.fadeTimer = null; }

  // Auto-play word TTS after brief pause
  setTimeout(() => tts.sayWord(entry.word), 350);

  // Fade word after 2.3s
  swSession.fadeTimer = setTimeout(() => wordEl.classList.add('faded'), 2300);

  // Render options
  const grid = document.getElementById('sw-options-grid');
  const renderOptions = () => {
    grid.innerHTML = '';
    entry.options.forEach(opt => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'sw-option';
      btn.textContent = opt;
      btn.addEventListener('click', () => onSWOptionTap(btn, opt, entry));
      grid.appendChild(btn);
    });
    if (animate) {
      grid.classList.remove('slide-out');
      grid.classList.add('slide-in');
      grid.addEventListener('animationend', () => grid.classList.remove('slide-in'), { once: true });
    }
  };
  if (animate) {
    grid.classList.add('slide-out');
    grid.addEventListener('animationend', renderOptions, { once: true });
  } else {
    renderOptions();
  }
}

function playSWWord() {
  const entry = swSession?.words[swSession.currentIdx];
  if (!entry) return;
  const btn = document.getElementById('sw-speaker-btn');
  btn.classList.add('playing');
  btn.addEventListener('animationend', () => btn.classList.remove('playing'), { once: true });
  tts.sayWord(entry.word);
}

function onSWWordTap() {
  // Re-reveal the word for another 2 seconds
  const wordEl = document.getElementById('sw-word');
  wordEl.classList.remove('faded');
  if (swSession) {
    if (swSession.fadeTimer) clearTimeout(swSession.fadeTimer);
    swSession.fadeTimer = setTimeout(() => wordEl.classList.add('faded'), 2000);
  }
}

function onSWOptionTap(btn, tappedWord, entry) {
  if (btn.classList.contains('correct') || btn.classList.contains('locked-out')) return;
  try { if (audioCtx?.state === 'suspended') audioCtx.resume(); } catch (e) {}
  tts.unlockFromGesture();

  entry.taps++;

  if (tappedWord === entry.word) {
    btn.classList.add('correct');
    soundCorrect();
    tts.sayWord(entry.word);
    // Mastery: +2 first-tap correct, +1 second-tap, +0 third+
    const pts = entry.taps === 1 ? 2 : entry.taps === 2 ? 1 : 0;
    state.swMastery[entry.word] = (state.swMastery[entry.word] ?? 0) + pts;
    entry.solved = true;
    setTimeout(() => advanceSWWord(), 800);
  } else {
    swSession.totalIncorrect++;
    soundIncorrect();
    btn.classList.add('shake');
    btn.addEventListener('animationend', () => btn.classList.remove('shake'), { once: true });
    // Per-button lockout after 2 wrong taps on that specific button
    const wrongTaps = parseInt(btn.dataset.wrongTaps || '0') + 1;
    btn.dataset.wrongTaps = String(wrongTaps);
    if (wrongTaps >= 2) btn.classList.add('locked-out');
  }
}

function advanceSWWord() {
  if (!swSession) return;
  const next = swSession.currentIdx + 1;
  if (next >= SW_WORDS_PER_SESSION) {
    soundRoundComplete();
    setTimeout(() => onSWComplete(), 800);
  } else {
    loadSWWord(next, true);
  }
}

function onSWComplete() {
  const duration = Math.round((Date.now() - swSession.sessionStartTime) / 1000);

  let stars;
  if (swSession.totalIncorrect === 0) {
    stars = duration < 60 ? 3 : 2;
  } else if (swSession.totalIncorrect <= 3) {
    stars = 1;
  } else {
    stars = 0;
  }

  // Streak â€” only advance once per day (shared with LH)
  const today = getTodayStr();
  if (state.lastPlayDate !== today) {
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yStr = `${yesterday.getFullYear()}-${String(yesterday.getMonth()+1).padStart(2,'0')}-${String(yesterday.getDate()).padStart(2,'0')}`;
    state.streak = (state.lastPlayDate === yStr || !state.lastPlayDate) ? state.streak + 1 : 1;
    state.lastPlayDate = today;
  }

  // Pick collectible card (seeded by date + mode + stars)
  const seed = dateHash(today + 'sw' + stars);
  const pool = stars >= 2
    ? CARDS.filter(c => c.rarity === 'rare')
    : CARDS.filter(c => c.rarity === 'standard');
  const card = pool[seed % pool.length];

  state.swTodayDone  = true;
  state.swTodayStars = stars;
  state.swEarnedCard = card;
  if (!state.earnedCards.includes(card.name)) state.earnedCards.push(card.name);

  saveProgress();
  showSWSummary(stars, card);
}

function showSWSummary(stars, card) {
  summaryMode = 'sw';
  showScreen('summary');
  soundSessionComplete();
  spawnConfetti(25);

  const titles = ['Keep practicing!', 'Great job!', 'Excellent!', 'Perfect!'];
  document.getElementById('summary-title').textContent = titles[Math.min(stars, 3)];
  document.getElementById('summary-date').textContent  = 'Sight Word Dash Â· ' + formatDate(getTodayStr());

  ['star1', 'star2', 'star3'].forEach((id, i) => {
    const el = document.getElementById(id);
    el.classList.remove('earned');
    if (i < stars) setTimeout(() => el.classList.add('earned'), 300 + i * 250);
  });

  const labels = ['Keep practicing! âœ¨', 'Great job! ğŸ‰', 'Excellent! ğŸŒŸ', 'Perfect! ğŸ†'];
  document.getElementById('star-label').textContent = labels[Math.min(stars, 3)];

  const cardEl = document.getElementById('card-reveal');
  cardEl.className = 'card-reveal' + (card.rarity === 'rare' ? ' rare' : '');
  document.getElementById('card-emoji').textContent   = card.emoji;
  document.getElementById('card-name').textContent    = card.name;
  document.getElementById('card-rarity').textContent  = card.rarity === 'rare' ? 'âœ¨ Rare card!' : "Today's card";
  document.getElementById('summary-streak-count').textContent = state.streak;
}

function showTodaySWSummary() {
  const card = state.swEarnedCard || CARDS[0];
  showSWSummary(state.swTodayStars, card);
}

/* â”€â”€â”€ Word Match â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const WM_ROUNDS_PER_SESSION = 4;
const WM_PAIRS_PER_ROUND = 4;

let wmSession = null;

function buildWMSession() {
  const tier  = SIGHT_WORD_TIERS.pre_primer;
  const today = getTodayStr();
  const seed  = dateHash(today + 'wm');

  const words = tier.map(w => w.word);

  // Group by visual complexity (character length)
  const bands = [[], [], [], []];
  words.forEach(w => {
    const len = w.length;
    if (len <= 2)      bands[0].push(w);
    else if (len <= 3) bands[1].push(w);
    else if (len <= 4) bands[2].push(w);
    else               bands[3].push(w);
  });

  const rounds = [];
  for (let r = 0; r < WM_ROUNDS_PER_SESSION; r++) {
    const band     = bands[r % bands.length];
    const shuffled = seededShuffle([...band], seed + r * 31);
    const picked   = shuffled.slice(0, WM_PAIRS_PER_ROUND);

    // Right side: same words in a different order
    let rightOrder, attempts = 0;
    do {
      rightOrder = seededShuffle([...picked], seed + r * 31 + 100 + attempts);
      attempts++;
    } while (attempts < 10 && rightOrder.every((w, i) => w === picked[i]));

    rounds.push({ leftWords: picked, rightWords: rightOrder, matched: new Set(), incorrect: 0 });
  }

  return { rounds, currentRound: 0, totalIncorrect: 0, sessionStartTime: Date.now(), selectedLeft: null };
}

function startWordMatch() {
  if (state.wmTodayDone) { showTodayWMSummary(); return; }
  if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume();
  tts.unlockFromGesture();

  wmSession = buildWMSession();
  showScreen('wm-game');
  document.getElementById('wm-game-streak').textContent = state.streak;
  loadWMRound(0);
}

function buildWMDots(currentIdx) {
  const container = document.getElementById('wm-dots');
  container.innerHTML = '';
  for (let i = 0; i < WM_ROUNDS_PER_SESSION; i++) {
    const dot = document.createElement('div');
    dot.className = 'dot' +
      (i < currentIdx   ? ' done'    : '') +
      (i === currentIdx ? ' current' : '');
    container.appendChild(dot);
  }
}

function loadWMRound(idx) {
  if (!wmSession) return;
  wmSession.currentRound = idx;
  wmSession.selectedLeft = null;
  const round = wmSession.rounds[idx];
  if (!round) return;

  buildWMDots(idx);

  const leftCol  = document.getElementById('wm-left');
  const rightCol = document.getElementById('wm-right');
  const svg      = document.getElementById('wm-lines');

  leftCol.innerHTML  = '';
  rightCol.innerHTML = '';
  svg.innerHTML      = '';

  // Left words
  round.leftWords.forEach(word => {
    const el = document.createElement('div');
    el.className    = 'wm-word';
    el.textContent  = word;
    el.dataset.word = word;
    el.addEventListener('pointerdown', e => onWMLeftDown(e, el, word));
    leftCol.appendChild(el);
  });

  // Right words
  round.rightWords.forEach(word => {
    const el = document.createElement('div');
    el.className    = 'wm-word';
    el.textContent  = word;
    el.dataset.word = word;
    el.addEventListener('click', () => onWMRightTap(el, word));
    rightCol.appendChild(el);
  });
}

/* â”€â”€â”€ WM interaction: left side (tap + drag) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function onWMLeftDown(e, el, word) {
  if (!wmSession) return;
  const round = wmSession.rounds[wmSession.currentRound];
  if (round.matched.has(word)) return;
  if (e.pointerType === 'mouse' && e.button !== 0) return;
  e.preventDefault();

  // Select this word (works for both tap and drag start)
  document.querySelectorAll('#wm-left .wm-word.selected').forEach(w => w.classList.remove('selected'));
  el.classList.add('selected');
  wmSession.selectedLeft = word;
  tts.sayWord(word);

  // Drag tracking
  const startX = e.clientX, startY = e.clientY;
  let isDragging = false;
  let tempLine   = null;

  el.setPointerCapture(e.pointerId);

  const area = document.getElementById('wm-area');
  const svg  = document.getElementById('wm-lines');

  const onMove = (ev) => {
    if (!isDragging && Math.hypot(ev.clientX - startX, ev.clientY - startY) > 10) {
      isDragging = true;
      const aRect = area.getBoundingClientRect();
      const lRect = el.getBoundingClientRect();
      tempLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      tempLine.setAttribute('x1', lRect.right - aRect.left);
      tempLine.setAttribute('y1', lRect.top + lRect.height / 2 - aRect.top);
      tempLine.classList.add('wm-line', 'temp', 'active');
      svg.appendChild(tempLine);
    }
    if (isDragging && tempLine) {
      const aRect = area.getBoundingClientRect();
      tempLine.setAttribute('x2', ev.clientX - aRect.left);
      tempLine.setAttribute('y2', ev.clientY - aRect.top);
    }
  };

  const onUp = (ev) => {
    el.removeEventListener('pointermove', onMove);
    el.removeEventListener('pointerup', onUp);
    el.removeEventListener('pointercancel', onUp);
    if (tempLine) tempLine.remove();
    if (!isDragging) return; // simple tap â€” word is already selected, wait for right-side tap

    // Find nearest unmatched right word
    const rightEls = document.querySelectorAll('#wm-right .wm-word:not(.matched)');
    let nearest = null, nearestDist = Infinity;
    rightEls.forEach(rEl => {
      const r = rEl.getBoundingClientRect();
      const dist = Math.hypot(ev.clientX - (r.left + r.width / 2), ev.clientY - (r.top + r.height / 2));
      if (dist < nearestDist) { nearestDist = dist; nearest = rEl; }
    });

    if (nearest && nearestDist < 80) {
      const target = nearest.dataset.word;
      tts.sayWord(target);
      if (target === word) {
        onWMCorrectMatch(target);
      } else {
        round.incorrect++;
        wmSession.totalIncorrect++;
        soundIncorrect();
        nearest.classList.add('shake');
        nearest.addEventListener('animationend', () => nearest.classList.remove('shake'), { once: true });
      }
    }
  };

  el.addEventListener('pointermove', onMove);
  el.addEventListener('pointerup', onUp);
  el.addEventListener('pointercancel', onUp);
}

/* â”€â”€â”€ WM interaction: right side (tap) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function onWMRightTap(el, word) {
  if (!wmSession || !wmSession.selectedLeft) return;
  const round = wmSession.rounds[wmSession.currentRound];
  if (round.matched.has(word)) return;

  tts.sayWord(word);

  if (word === wmSession.selectedLeft) {
    onWMCorrectMatch(word);
  } else {
    round.incorrect++;
    wmSession.totalIncorrect++;
    soundIncorrect();
    el.classList.add('shake');
    el.addEventListener('animationend', () => el.classList.remove('shake'), { once: true });
  }
}

/* â”€â”€â”€ WM correct match â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function onWMCorrectMatch(word) {
  const round = wmSession.rounds[wmSession.currentRound];
  round.matched.add(word);
  soundCorrect();
  setTimeout(() => tts.sayWord(word), 300);

  // Mark both sides matched
  document.querySelectorAll('#wm-left .wm-word').forEach(el => {
    if (el.dataset.word === word) { el.classList.remove('selected'); el.classList.add('matched'); }
  });
  document.querySelectorAll('#wm-right .wm-word').forEach(el => {
    if (el.dataset.word === word) el.classList.add('matched');
  });

  wmSession.selectedLeft = null;
  drawWMLine(word);

  if (round.matched.size >= WM_PAIRS_PER_ROUND) {
    setTimeout(() => onWMRoundComplete(), 800);
  }
}

function drawWMLine(word) {
  const area    = document.getElementById('wm-area');
  const svg     = document.getElementById('wm-lines');
  const leftEl  = document.querySelector('#wm-left .wm-word[data-word="' + word + '"]');
  const rightEl = document.querySelector('#wm-right .wm-word[data-word="' + word + '"]');
  if (!leftEl || !rightEl || !area) return;

  const aRect = area.getBoundingClientRect();
  const lRect = leftEl.getBoundingClientRect();
  const rRect = rightEl.getBoundingClientRect();

  const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
  line.setAttribute('x1', lRect.right  - aRect.left);
  line.setAttribute('y1', lRect.top + lRect.height / 2 - aRect.top);
  line.setAttribute('x2', rRect.left   - aRect.left);
  line.setAttribute('y2', rRect.top + rRect.height / 2 - aRect.top);
  line.classList.add('wm-line');
  svg.appendChild(line);

  requestAnimationFrame(() => {
    line.classList.add('active');
    setTimeout(() => line.classList.add('matched'), 500);
  });
}

function onWMRoundComplete() {
  soundRoundComplete();
  spawnConfetti(8);

  const next = wmSession.currentRound + 1;
  if (next >= WM_ROUNDS_PER_SESSION) {
    setTimeout(() => onWMComplete(), 1200);
  } else {
    setTimeout(() => loadWMRound(next), 1000);
  }
}

/* â”€â”€â”€ WM session complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function onWMComplete() {
  const duration = Math.round((Date.now() - wmSession.sessionStartTime) / 1000);

  let stars;
  if (wmSession.totalIncorrect === 0) {
    stars = duration < 90 ? 3 : 2;
  } else if (wmSession.totalIncorrect <= 3) {
    stars = 1;
  } else {
    stars = 0;
  }

  // Streak â€” only advance once per day (shared)
  const today = getTodayStr();
  if (state.lastPlayDate !== today) {
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    const yStr = `${yesterday.getFullYear()}-${String(yesterday.getMonth()+1).padStart(2,'0')}-${String(yesterday.getDate()).padStart(2,'0')}`;
    state.streak = (state.lastPlayDate === yStr || !state.lastPlayDate) ? state.streak + 1 : 1;
    state.lastPlayDate = today;
  }

  // Pick collectible card
  const seed = dateHash(today + 'wm' + stars);
  const pool = stars >= 2
    ? CARDS.filter(c => c.rarity === 'rare')
    : CARDS.filter(c => c.rarity === 'standard');
  const card = pool[seed % pool.length];

  state.wmTodayDone  = true;
  state.wmTodayStars = stars;
  state.wmEarnedCard = card;
  if (!state.earnedCards.includes(card.name)) state.earnedCards.push(card.name);

  saveProgress();
  showWMSummary(stars, card);
}

function showWMSummary(stars, card) {
  summaryMode = 'wm';
  showScreen('summary');
  soundSessionComplete();
  spawnConfetti(25);

  const titles = ['Keep practicing!', 'Great job!', 'Excellent!', 'Perfect!'];
  document.getElementById('summary-title').textContent = titles[Math.min(stars, 3)];
  document.getElementById('summary-date').textContent  = 'Word Match Â· ' + formatDate(getTodayStr());

  ['star1', 'star2', 'star3'].forEach((id, i) => {
    const el = document.getElementById(id);
    el.classList.remove('earned');
    if (i < stars) setTimeout(() => el.classList.add('earned'), 300 + i * 250);
  });

  const labels = ['Keep practicing! âœ¨', 'Great job! ğŸ‰', 'Excellent! ğŸŒŸ', 'Perfect! ğŸ†'];
  document.getElementById('star-label').textContent = labels[Math.min(stars, 3)];

  const cardEl = document.getElementById('card-reveal');
  cardEl.className = 'card-reveal' + (card.rarity === 'rare' ? ' rare' : '');
  document.getElementById('card-emoji').textContent   = card.emoji;
  document.getElementById('card-name').textContent    = card.name;
  document.getElementById('card-rarity').textContent  = card.rarity === 'rare' ? 'âœ¨ Rare card!' : "Today's card";
  document.getElementById('summary-streak-count').textContent = state.streak;
}

function showTodayWMSummary() {
  const card = state.wmEarnedCard || CARDS[0];
  showWMSummary(state.wmTodayStars, card);
}

/* â”€â”€â”€ Gallery â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openGallery() {
  renderGallery();
  showScreen('gallery');
}

function renderGallery() {
  const grid    = document.getElementById('gallery-grid');
  const countEl = document.getElementById('gallery-count');
  grid.innerHTML = '';

  const earned = CARDS.filter(c => state.earnedCards.includes(c.name));
  countEl.textContent = earned.length === 0 ? '' : `${earned.length} badge${earned.length !== 1 ? 's' : ''}`;

  if (earned.length === 0) {
    grid.innerHTML = `
      <div class="gallery-empty">
        <div class="gallery-empty-icon">ğŸ¾</div>
        <div class="gallery-empty-text">Play Letter Hunt, Sight Word Dash, or Word Match to earn your first animal badge!</div>
      </div>
    `;
    return;
  }

  earned.forEach(card => {
    const el = document.createElement('div');
    el.className = 'gc' + (card.rarity === 'rare' ? ' gc-rare' : '');
    el.innerHTML = `<div class="gc-emoji">${card.emoji}</div><div class="gc-name">${card.name}</div>`;
    el.addEventListener('click', () => onBadgeTap(el, card));
    grid.appendChild(el);
  });
}

function onBadgeTap(el, card) {
  // Restart bounce animation on every tap
  el.classList.remove('bounce');
  void el.offsetWidth; // force reflow so animation replays
  el.classList.add('bounce');
  el.addEventListener('animationend', () => el.classList.remove('bounce'), { once: true });
  // Play win chime + speak the animal name
  soundRoundComplete();
  tts.sayWord(card.name);
}

/* â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function init() {
  loadProgress();
  updateHomeUI();
  tts.init(); // async, fire-and-forget; voices load well before first interaction
}

init();
</script>
</body>
</html>
